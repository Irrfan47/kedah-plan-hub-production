import{j as e}from"./ui-vendor-1754357358322-Bp-UNE15.js";import{g as s,f as a,u as t,r}from"./react-vendor-1754357358322-BCu8432v.js";import{C as l,c as n,a as c,b as i}from"./card-1754357358322-jzcAFHNM.js";import{b as d,u as m,a as o,c as x,B as u,S as h,I as p}from"./index-1754357358322-CldQuBx-.js";import{B as j}from"./badge-1754357358322-C6KBoXlc.js";import{A as g,S as _,F as f,m as v,n as N,o as b,D as y,b as w}from"./icons-vendor-1754357358322-D5w6PadE.js";import"./utils-vendor-1754357358322-CYErry0n.js";import"./query-vendor-1754357358322-D8Bw-8e5.js";function k(){var k,S;const{userId:C}=s(),P=a(),q=t(),{t:U}=d(),{user:E}=m(),{toast:F}=o(),[R,$]=r.useState(null),[B,I]=r.useState(null),[L,M]=r.useState(!0),[T,A]=r.useState(!1),[O,D]=r.useState(""),[J,z]=r.useState(!1);r.useEffect(()=>{var e;(null==(e=q.state)?void 0:e.excoUser)&&$(q.state.excoUser),G()},[C]);const G=async()=>{try{M(!0);const e=await fetch(`${x}/programs.php?exco_user_id=${C}`),s=await e.json(),a=s.success&&s.programs||[],t=a.length,r=a.filter(e=>"payment_completed"===e.status).length,l=a.filter(e=>"rejected"===e.status).length,n=a.filter(e=>"draft"===e.status||"pending"===e.status).length,c=await fetch(`${x}/users.php?exco_stats=1`),i=await c.json(),d=i.success?i.users.find(e=>e.id==C):null;I({total_programs:t,payment_completed_programs:r,rejected_programs:l,pending_programs:n,total_budget:(null==d?void 0:d.total_budget)||0,remaining_budget:(null==d?void 0:d.remaining_budget)||0,recent_programs:a.slice(0,5)})}catch(e){}finally{M(!1)}},H=()=>{P("/exco-users")};return L?e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(u,{variant:"outline",onClick:H,className:"mb-4",children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),U("exco.users.back_to_exco_users")]}),e.jsx(h,{className:"h-8 w-64 mb-2"}),e.jsx(h,{className:"h-4 w-96"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:Array.from({length:4}).map((s,a)=>e.jsx(l,{children:e.jsxs(n,{className:"p-6",children:[e.jsx(h,{className:"h-8 w-24 mb-2"}),e.jsx(h,{className:"h-6 w-16"})]})},a))}),e.jsxs(l,{children:[e.jsx(c,{children:e.jsx(h,{className:"h-6 w-48"})}),e.jsx(n,{children:e.jsx(h,{className:"h-64 w-full"})})]})]}):e.jsxs("div",{className:"container mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs(u,{variant:"outline",onClick:H,children:[e.jsx(g,{className:"h-4 w-4 mr-2"}),U("exco.users.back_to_exco_users")]}),("finance_mmk"===(null==E?void 0:E.role)||"admin"===(null==E?void 0:E.role)||"finance_officer"===(null==E?void 0:E.role)||"super_admin"===(null==E?void 0:E.role))&&e.jsxs(u,{onClick:()=>{P("/programs",{state:{selectedUserId:C,selectedUserName:null==R?void 0:R.full_name}})},className:"bg-blue-600 hover:bg-blue-700",children:[e.jsx(_,{className:"h-4 w-4 mr-2"}),U("exco.users.manage_programs")]})]}),R&&e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[R.profile_picture?e.jsx("img",{src:R.profile_picture,alt:R.full_name,className:"w-16 h-20 object-cover rounded-lg"}):e.jsx("div",{className:"w-16 h-20 bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-semibold text-gray-500",children:R.full_name.split(" ").map(e=>e[0]).join("").toUpperCase()})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:R.full_name}),e.jsx("p",{className:"text-gray-600",children:R.email})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Programs"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(null==B?void 0:B.total_programs)||0})]}),e.jsx(f,{className:"h-8 w-8 text-blue-600"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Payment Completed Programs"}),e.jsx("p",{className:"text-2xl font-bold text-green-600",children:(null==B?void 0:B.payment_completed_programs)||0})]}),e.jsx(v,{className:"h-8 w-8 text-green-600"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rejected Programs"}),e.jsx("p",{className:"text-2xl font-bold text-red-600",children:(null==B?void 0:B.rejected_programs)||0})]}),e.jsx(N,{className:"h-8 w-8 text-red-600"})]})})}),e.jsx(l,{children:e.jsx(n,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Pending Programs"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:(null==B?void 0:B.pending_programs)||0})]}),e.jsx(b,{className:"h-8 w-8 text-yellow-600"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),U("exco.dashboard.total_budget")]})}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:["RM ",(null==(k=null==B?void 0:B.total_budget)?void 0:k.toLocaleString())||0]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[U("exco.dashboard.remaining_budget"),": RM ",(null==(S=null==B?void 0:B.remaining_budget)?void 0:S.toLocaleString())||0]})]}),"finance_mmk"===(null==E?void 0:E.role)&&e.jsx("div",{children:J?e.jsxs("div",{className:"space-y-2",children:[e.jsx(p,{type:"number",placeholder:U("dashboard.enter_budget"),value:O,onChange:e=>D(e.target.value)}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(u,{onClick:async()=>{if(!O||!C)return;const e=parseFloat(O);if(isNaN(e)||e<0)F({title:"Error",description:"Please enter a valid budget amount",variant:"destructive"});else{A(!0);try{const s={user_id:Number(C),total_budget:Number(e)},a=await fetch(`${x}/users.php?set_budget=1`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),t=await a.json();t.success?(F({title:"Success",description:"Budget updated successfully"}),z(!1),D(""),G()):F({title:"Error",description:t.message||"Failed to update budget",variant:"destructive"})}catch(s){F({title:"Error",description:"Failed to update budget",variant:"destructive"})}finally{A(!1)}}},disabled:T,children:U(T?"common.updating":"common.save")}),e.jsx(u,{variant:"outline",onClick:()=>{z(!1),D("")},children:U("common.cancel")})]})]}):e.jsx(u,{onClick:()=>z(!0),children:U("exco.users.update_budget")})})]})})]}),e.jsxs(l,{children:[e.jsx(c,{children:e.jsxs(i,{className:"flex items-center gap-2",children:[e.jsx(w,{className:"h-5 w-5"}),U("exco.dashboard.user_information")]})}),e.jsx(n,{children:R&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:U("profile.full_name")}),e.jsx("p",{className:"text-gray-900",children:R.full_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:U("profile.email")}),e.jsx("p",{className:"text-gray-900",children:R.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:U("profile.phone")}),e.jsx("p",{className:"text-gray-900",children:R.phone_number||U("exco.users.no_phone")})]})]})})]})]}),e.jsxs(l,{children:[e.jsx(c,{children:e.jsx(i,{children:U("exco.dashboard.recent_programs")})}),e.jsx(n,{children:(null==B?void 0:B.recent_programs)&&B.recent_programs.length>0?e.jsx("div",{className:"space-y-4",children:B.recent_programs.map(s=>{var a,t;return e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:s.program_name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[U("programs.budget"),": RM ",(null==(a=s.budget)?void 0:a.toLocaleString())||0]})]}),e.jsx(j,{variant:"payment_completed"===s.status?"default":"rejected"===s.status?"destructive":"pending"===s.status?"secondary":"outline",children:U((t=s.status,{draft:"status.draft",under_review:"status.under_review",query:"status.query",query_answered:"status.query_answered",complete_can_send_to_mmk:"status.complete_can_send_to_mmk",under_review_by_mmk:"status.under_review_by_mmk",document_accepted_by_mmk:"status.document_accepted_by_mmk",payment_in_progress:"status.payment_in_progress",payment_completed:"status.payment_completed",rejected:"status.rejected"}[t]||"status.draft"))})]},s.id)})}):e.jsx("p",{className:"text-gray-500 text-center py-4",children:U("exco.dashboard.no_recent_programs")})})]})]})}export{k as default};
