import{j as e}from"./ui-vendor-1754357358322-Bp-UNE15.js";import{u as s,r as a}from"./react-vendor-1754357358322-BCu8432v.js";import{u as t,a as r,b as n,c as i,B as l,I as c,v as d,l as o,m,k as u,n as x,o as p,p as h,q as g,r as j,s as v,t as f,w as y}from"./index-1754357358322-CldQuBx-.js";import{C as _,a as N,b,c as w}from"./card-1754357358322-jzcAFHNM.js";import{T as k,a as C,b as P,c as S,d as K,e as A}from"./table-1754357358322-C8S8WM1D.js";import{B as D}from"./badge-1754357358322-C6KBoXlc.js";import{L as E}from"./label-1754357358322-2ywHf4zy.js";import{T as z}from"./textarea-1754357358322-BlPR2iv_.js";import{D as F,a as q,b as B,c as R,d as M}from"./dialog-1754357358322-2hcCCz0x.js";import{S as L,a as $,b as O,c as T,d as U}from"./select-1754357358322-DTWo5oSS.js";import{E as Q}from"./ExcoUserBudgetTable-1754357358322-DEBx-9LI.js";import{w as I,X as V,l as X,M as Y,x as G,y as J,f as H,v as W,z as Z,F as ee,G as se,o as ae,h as te,m as re,p as ne,i as ie}from"./icons-vendor-1754357358322-D5w6PadE.js";import"./utils-vendor-1754357358322-CYErry0n.js";import"./query-vendor-1754357358322-D8Bw-8e5.js";const le=e=>{const s={draft:"bg-gray-100 text-gray-800",under_review:"bg-blue-100 text-blue-800",query:"bg-orange-100 text-orange-800",query_answered:"bg-purple-100 text-purple-800",complete_can_send_to_mmk:"bg-yellow-100 text-yellow-800",under_review_by_mmk:"bg-indigo-100 text-indigo-800",document_accepted_by_mmk:"bg-green-100 text-green-800",payment_in_progress:"bg-teal-100 text-teal-800",payment_completed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"};return s[e]||s.draft},ce=e=>({draft:"status.draft",under_review:"status.under_review",query:"status.query",query_answered:"status.query_answered",complete_can_send_to_mmk:"status.complete_can_send_to_mmk",under_review_by_mmk:"status.under_review_by_mmk",document_accepted_by_mmk:"status.document_accepted_by_mmk",payment_in_progress:"status.payment_in_progress",payment_completed:"status.payment_completed",rejected:"status.rejected"}[e]||"status.draft");function de(){var de;const{user:oe}=t(),{toast:me}=r(),{t:ue}=n(),xe=s(),[pe,he]=a.useState([]),[ge,je]=a.useState(!1),[ve,fe]=a.useState(!1),[ye,_e]=a.useState(null),[Ne,be]=a.useState(!1),[we,ke]=a.useState(!1);a.useState(!1);const[Ce,Pe]=a.useState(!1),[Se,Ke]=a.useState("all"),[Ae,De]=a.useState("original"),[Ee,ze]=a.useState(!1),[Fe,qe]=a.useState(!1),[Be,Re]=a.useState(!1),[Me,Le]=a.useState(null),[$e,Oe]=a.useState(""),[Te,Ue]=a.useState(""),[Qe,Ie]=a.useState({}),[Ve,Xe]=a.useState(""),[Ye,Ge]=a.useState(""),[Je,He]=a.useState({programName:"",budget:"",recipientName:"",excoLetterRef:"",suratAkuanPusatKhidmat:null,suratKelulusanPkn:null,suratProgram:null,suratExco:null,penyataAkaunBank:null,borangDaftarKod:null}),[We,Ze]=a.useState({programName:"",budget:"",recipientName:"",excoLetterRef:"",suratAkuanPusatKhidmat:null,suratKelulusanPkn:null,suratProgram:null,suratExco:null,penyataAkaunBank:null,borangDaftarKod:null}),[es,ss]=a.useState("");a.useState(null);const[as,ts]=a.useState(null),[rs,ns]=a.useState(!1),[is,ls]=a.useState(null),[cs,ds]=a.useState(!1),[os,ms]=a.useState(null),[us,xs]=a.useState(!1),[ps,hs]=a.useState(null),[gs,js]=a.useState(!1),[vs,fs]=a.useState(null),[ys,_s]=a.useState(!1),[Ns,bs]=a.useState(null),[ws,ks]=a.useState(!1),[Cs,Ps]=a.useState(null),[Ss,Ks]=a.useState(null),[As,Ds]=a.useState(!1),[Es,zs]=a.useState(!1),[Fs,qs]=a.useState({}),[Bs,Rs]=a.useState(1),[Ms]=a.useState(5),Ls="exco_user"===(null==oe?void 0:oe.role);null==oe||oe.role;const $s="finance_mmk"===(null==oe?void 0:oe.role)||"finance_officer"===(null==oe?void 0:oe.role)||"super_admin"===(null==oe?void 0:oe.role),[Os,Ts]=a.useState([]),[Us,Qs]=a.useState(null),[Is,Vs]=a.useState(!0),[Xs,Ys]=a.useState(!1);a.useEffect(()=>{var e,s;try{Gs(),fetch(`${i}/users.php`).then(e=>e.json()).then(e=>{if(e.success&&e.users){const s={};e.users.forEach(e=>{s[e.id]=e.fullName||e.full_name||e.email||e.id}),Ie(s)}}).catch(e=>{}),(null==(e=xe.state)?void 0:e.selectedUserId)&&(null==(s=xe.state)?void 0:s.selectedUserName)?(Qs({id:xe.state.selectedUserId,name:xe.state.selectedUserName}),Js(xe.state.selectedUserId)):"exco_user"===(null==oe?void 0:oe.role)&&(null==oe?void 0:oe.id)&&(Qs({id:oe.id,name:oe.fullName||oe.full_name||oe.email||"EXCO User"}),Js(oe.id))}catch(a){}},[oe,xe.state]);const Gs=async()=>{Vs(!0);try{const e=await fetch(`${i}/users.php?exco_stats=1`),s=await e.json();s.success&&Ts(s.users)}catch(e){me({title:ue("common.error"),description:"Failed to fetch EXCO users",variant:"destructive"})}finally{Vs(!1)}},Js=async e=>{Ys(!0);try{const s=await fetch(`${i}/programs.php?exco_user_id=${e}`),a=await s.json();a.success?he(a.programs||[]):he([])}catch(s){me({title:ue("common.error"),description:"Failed to fetch programs",variant:"destructive"}),he([])}finally{Ys(!1)}},Hs=pe.filter(e=>"all"===Se||e.status===Se).sort((e,s)=>{const a=parseInt(e.id);return parseInt(s.id)-a}),Ws=Math.ceil(Hs.length/Ms),Zs=Bs*Ms,ea=Zs-Ms,sa="exco_user"===(null==oe?void 0:oe.role)?Hs.slice(ea,Zs):Hs;a.useEffect(()=>{Rs(1)},[Se]);const aa=async e=>{try{const s=await v(e);if(s.success){if(me({title:ue("common.success"),description:ue("programs.document_deleted")}),ye)if("exco_user"===(null==oe?void 0:oe.role)){const e=await fetch(`${i}/programs.php?exco_user_id=${oe.id}`),s=await e.json();if(s.success){const e=s.programs.find(e=>e.id===ye.id);e&&_e(e)}}else if(Us){const e=await fetch(`${i}/programs.php?exco_user_id=${Us.id}`),s=await e.json();if(s.success){const e=s.programs.find(e=>e.id===ye.id);e&&_e(e)}}else{const e=await u();if(e.success){const s=e.programs.find(e=>e.id===ye.id);s&&_e(s)}}}else me({title:ue("common.error"),description:s.message||ue("programs.delete_document_failed"),variant:"destructive"})}catch(s){me({title:ue("common.error"),description:ue("programs.delete_document_failed"),variant:"destructive"})}},ta=({program:s})=>{const{t:a}=n(),t=[{key:"draft",label:a("timeline.draft"),icon:ee,color:"bg-gray-500"},{key:"under_review",label:a("timeline.under_review"),icon:ae,color:"bg-blue-500"},{key:"query",label:a("timeline.query"),icon:te,color:"bg-orange-500"},{key:"query_answered",label:a("timeline.query_answered"),icon:re,color:"bg-purple-500"},{key:"complete_can_send_to_mmk",label:a("timeline.complete_can_send_to_mmk"),icon:J,color:"bg-yellow-500"},{key:"under_review_by_mmk",label:a("timeline.under_review_by_mmk"),icon:ae,color:"bg-indigo-500"},{key:"document_accepted_by_mmk",label:a("timeline.document_accepted_by_mmk"),icon:re,color:"bg-teal-500"},{key:"payment_in_progress",label:a("timeline.payment_in_progress"),icon:ae,color:"bg-amber-500"},{key:"payment_completed",label:a("timeline.payment_completed"),icon:re,color:"bg-green-500"}];t.findIndex(e=>e.key===s.status);const r=Fs[s.id]||!1,i=e=>{if(!s.status_history||!Array.isArray(s.status_history))return new Date(s.created_at||s.createdAt);const a=s.status_history.find(s=>s.status===e);if(a)return new Date(a.changed_at);if("draft"===e){const e=s.created_at||s.createdAt||s.created_date;return e?new Date(e):new Date}if("query"===e||"query_answered"===e){const e=s.status;if(["complete_can_send_to_mmk","under_review_by_mmk","document_accepted_by_mmk","payment_in_progress","payment_completed"].includes(e)){const e=s.status_history.find(e=>["complete_can_send_to_mmk","under_review_by_mmk","document_accepted_by_mmk","payment_in_progress","payment_completed"].includes(e.status));if(e)return new Date(e.changed_at)}}return new Date(s.created_at||s.createdAt)};return e.jsxs("div",{className:"p-4",children:[e.jsxs(l,{variant:"ghost",size:"sm",onClick:()=>qs(e=>({...e,[s.id]:!e[s.id]})),className:"flex items-center gap-2 text-sm mb-3",children:[r?e.jsx(ne,{className:"h-4 w-4"}):e.jsx(ie,{className:"h-4 w-4"}),a("timeline.status_timeline")]}),r&&e.jsx("div",{className:"bg-gray-50 rounded-lg p-4 w-full",children:e.jsxs("div",{className:"relative w-full",children:[e.jsx("div",{className:"absolute top-6 left-0 right-0 h-0.5 bg-gray-300"}),e.jsx("div",{className:"flex justify-between items-center relative w-full",children:t.map((t,r)=>{const n=t.icon,l=(e=>{const a=s.status;return"draft"===e||!("query"!==e&&"query_answered"!==e||!["complete_can_send_to_mmk","under_review_by_mmk","document_accepted_by_mmk","payment_in_progress","payment_completed"].includes(a))||!(!s.status_history||!Array.isArray(s.status_history))&&s.status_history.some(s=>s.status===e)})(t.key),c=s.status===t.key,d=!l&&!c;return e.jsxs("div",{className:"flex flex-col items-center relative",children:[e.jsx("div",{className:`relative z-10 w-10 h-10 rounded-full flex items-center justify-center ${l?t.color:"bg-gray-300"} ${c?"ring-4 ring-blue-200":""}`,children:e.jsx(n,{className:"h-5 w-5 "+(l?"text-white":"text-gray-500")})}),e.jsxs("div",{className:"mt-2 text-center max-w-[120px]",children:[e.jsx("div",{className:"text-xs font-medium "+(l?"text-gray-900":"text-gray-500"),children:t.label}),l&&e.jsx("div",{className:"text-xs text-gray-600 mt-1",children:(o=i(t.key),o.toLocaleDateString("en-MY",{day:"2-digit",month:"2-digit",year:"numeric"})+" "+o.toLocaleTimeString("en-MY",{hour:"2-digit",minute:"2-digit"}))}),c&&e.jsx("div",{className:"text-xs text-blue-600 font-medium mt-1",children:a("timeline.current")}),l&&!c&&e.jsx("div",{className:"text-xs text-green-600 font-medium mt-1",children:a("timeline.done")}),d&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:a("timeline.pending")})]})]},t.key);var o})})]})})]})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:ue("programs.title")}),e.jsx("p",{className:"text-muted-foreground",children:"finance_mmk"===(null==oe?void 0:oe.role)?"Set and manage EXCO user budgets. Click View to see programs for a user.":ue("programs.create_manage_desc")})]}),Ls&&("exco_user"===(null==oe?void 0:oe.role)||!Us)&&e.jsxs(F,{open:ge,onOpenChange:je,children:[e.jsx(q,{asChild:!0,children:e.jsxs(l,{children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),ue("programs.add_program")]})}),e.jsxs(B,{className:"max-w-2xl",children:[e.jsx(R,{children:e.jsx(M,{children:ue("programs.create_new_program")})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"programName",children:[ue("programs.program_name")," *"]}),e.jsx(c,{id:"programName",value:Je.programName,onChange:e=>He({...Je,programName:e.target.value}),placeholder:ue("programs.enter_program_name")})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"budget",children:[ue("programs.budget_rm")," *"]}),e.jsx(c,{id:"budget",type:"number",value:Je.budget,onChange:e=>He({...Je,budget:e.target.value}),placeholder:ue("programs.enter_budget_amount")})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"recipientName",children:[ue("programs.recipient_name")," *"]}),e.jsx(c,{id:"recipientName",value:Je.recipientName,onChange:e=>He({...Je,recipientName:e.target.value}),placeholder:ue("programs.enter_recipient_name")})]}),e.jsxs("div",{children:[e.jsxs(E,{htmlFor:"excoLetterRef",children:[ue("programs.exco_letter_ref")," *"]}),e.jsx(c,{id:"excoLetterRef",value:Je.excoLetterRef,onChange:e=>He({...Je,excoLetterRef:e.target.value}),placeholder:ue("programs.enter_reference_number")})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx(E,{className:"text-base font-semibold mb-3",children:ue("programs.documents")}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"text-sm font-medium min-w-[200px]",children:"Surat Akuan Pusat Khidmat"}),e.jsx(c,{type:"file",className:"flex-1",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&He({...Je,suratAkuanPusatKhidmat:a})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"}),Je.suratAkuanPusatKhidmat&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{He({...Je,suratAkuanPusatKhidmat:null})},children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"text-sm font-medium min-w-[200px]",children:"Surat Kelulusan Pkn"}),e.jsx(c,{type:"file",className:"flex-1",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&He({...Je,suratKelulusanPkn:a})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"}),Je.suratKelulusanPkn&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{He({...Je,suratKelulusanPkn:null})},children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"text-sm font-medium min-w-[200px]",children:"Surat Program"}),e.jsx(c,{type:"file",className:"flex-1",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&He({...Je,suratProgram:a})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"}),Je.suratProgram&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{He({...Je,suratProgram:null})},children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"text-sm font-medium min-w-[200px]",children:"Surat Exco"}),e.jsx(c,{type:"file",className:"flex-1",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&He({...Je,suratExco:a})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"}),Je.suratExco&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{He({...Je,suratExco:null})},children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"text-sm font-medium min-w-[200px]",children:"Penyata Akaun Bank"}),e.jsx(c,{type:"file",className:"flex-1",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&He({...Je,penyataAkaunBank:a})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"}),Je.penyataAkaunBank&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{He({...Je,penyataAkaunBank:null})},children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"text-sm font-medium min-w-[200px]",children:"Borang Daftar Kod"}),e.jsx(c,{type:"file",className:"flex-1",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&He({...Je,borangDaftarKod:a})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"}),Je.borangDaftarKod&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{He({...Je,borangDaftarKod:null})},children:e.jsx(V,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>je(!1),children:ue("common.cancel")}),e.jsx(l,{onClick:async()=>{if(!(Je.programName&&Je.budget&&Je.recipientName&&Je.excoLetterRef))return void me({title:ue("common.error"),description:ue("programs.fill_required_fields"),variant:"destructive"});const e=[{field:"suratAkuanPusatKhidmat",name:"Surat Akuan Pusat Khidmat"},{field:"suratKelulusanPkn",name:"Surat Kelulusan Pkn"},{field:"suratProgram",name:"Surat Program"},{field:"suratExco",name:"Surat Exco"},{field:"penyataAkaunBank",name:"Penyata Akaun Bank"},{field:"borangDaftarKod",name:"Borang Daftar Kod"}].filter(e=>!Je[e.field]);if(e.length>0){const s=e.map(e=>e.name).join(", ");return void me({title:ue("common.error"),description:`Please upload all required documents: ${s}`,variant:"destructive"})}const s={program_name:Je.programName,budget:parseFloat(Je.budget),recipient_name:Je.recipientName,exco_letter_ref:Je.excoLetterRef,created_by:null==oe?void 0:oe.id,status:"draft"},a=await h(s);if(a.success){const e=a.program_id;let s=0;const r=[{field:"suratAkuanPusatKhidmat",name:"Surat Akuan Pusat Khidmat"},{field:"suratKelulusanPkn",name:"Surat Kelulusan Pkn"},{field:"suratProgram",name:"Surat Program"},{field:"suratExco",name:"Surat Exco"},{field:"penyataAkaunBank",name:"Penyata Akaun Bank"},{field:"borangDaftarKod",name:"Borang Daftar Kod"}];for(const a of r){const r=Je[a.field];if(r)try{const t=r.name.split(".").pop(),n=`${a.name}(${e}).${t}`,i=new File([r],n,{type:r.type});(await g(e,i,(null==oe?void 0:oe.fullName)||(null==oe?void 0:oe.full_name)||"","original")).success&&s++}catch(t){}}me(s>0?{title:ue("common.success"),description:`${s} document(s) uploaded successfully`}:{title:ue("common.success"),description:ue("programs.created_successfully")}),"exco_user"===(null==oe?void 0:oe.role)?Js(oe.id):u().then(e=>{e.success&&e.programs&&he(e.programs)}),je(!1),He({programName:"",budget:"",recipientName:"",excoLetterRef:"",suratAkuanPusatKhidmat:null,suratKelulusanPkn:null,suratProgram:null,suratExco:null,penyataAkaunBank:null,borangDaftarKod:null})}else me({title:ue("common.error"),description:a.message||ue("programs.create_failed"),variant:"destructive"})},children:ue("programs.create_program")})]})]})]})]})]}),"exco_user"!==(null==oe?void 0:oe.role)&&!Us&&e.jsxs(_,{className:"card-elevated",children:[e.jsx(N,{children:e.jsx(b,{children:ue("exco.users.budgets")})}),e.jsx(w,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx(Q,{users:Os,userRole:(null==oe?void 0:oe.role)||"",showViewButton:!0,onViewUser:e=>{Qs(e),Js(e.id)},onBudgetChange:async(e,s)=>{const a={user_id:Number(e),total_budget:Number(s)};try{const e=await fetch(`${i}/users.php?set_budget=1`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),s=await e.json();s.success?(me({title:ue("common.success"),description:"Budget updated."}),Gs()):me({title:ue("common.error"),description:s.message||"Failed to update budget",variant:"destructive"})}catch(t){me({title:ue("common.error"),description:"Failed to update budget",variant:"destructive"})}}})})})]}),Us&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:["exco_user"!==(null==oe?void 0:oe.role)&&e.jsxs(l,{variant:"outline",onClick:()=>Qs(null),children:["← ",ue("exco.users.back_to_exco_users")]}),e.jsxs("h2",{className:"text-2xl font-semibold",children:[ue("programs.title")," for ",Us.name]})]}),e.jsxs(_,{children:[e.jsx(N,{children:e.jsx(b,{children:ue("programs.title")})}),e.jsxs(w,{children:[e.jsx("div",{className:"mb-4",children:e.jsxs(L,{value:Se,onValueChange:Ke,children:[e.jsx($,{className:"w-48",children:e.jsx(O,{placeholder:ue("status.filter_by_status")})}),e.jsxs(T,{children:[e.jsx(U,{value:"all",children:ue("status.all_status")}),$s&&e.jsxs(e.Fragment,{children:[e.jsx(U,{value:"under_review",children:ue("status.under_review")}),e.jsx(U,{value:"query",children:ue("status.query")}),e.jsx(U,{value:"query_answered",children:ue("status.query_answered")}),e.jsx(U,{value:"complete_can_send_to_mmk",children:ue("status.complete_can_send_to_mmk")}),e.jsx(U,{value:"under_review_by_mmk",children:ue("status.under_review_by_mmk")}),e.jsx(U,{value:"document_accepted_by_mmk",children:ue("status.document_accepted_by_mmk")}),e.jsx(U,{value:"payment_in_progress",children:ue("status.payment_in_progress")}),e.jsx(U,{value:"payment_completed",children:ue("status.payment_completed")}),e.jsx(U,{value:"rejected",children:ue("status.rejected")})]}),!$s&&e.jsxs(e.Fragment,{children:[e.jsx(U,{value:"draft",children:ue("status.draft")}),e.jsx(U,{value:"under_review",children:ue("status.under_review")}),e.jsx(U,{value:"query",children:ue("status.query")}),e.jsx(U,{value:"query_answered",children:ue("status.query_answered")}),e.jsx(U,{value:"complete_can_send_to_mmk",children:ue("status.complete_can_send_to_mmk")}),e.jsx(U,{value:"under_review_by_mmk",children:ue("status.under_review_by_mmk")}),e.jsx(U,{value:"document_accepted_by_mmk",children:ue("status.document_accepted_by_mmk")}),e.jsx(U,{value:"payment_in_progress",children:ue("status.payment_in_progress")}),e.jsx(U,{value:"payment_completed",children:ue("status.payment_completed")}),e.jsx(U,{value:"rejected",children:ue("status.rejected")})]})]})]})}),e.jsxs("div",{className:"rounded-md border overflow-x-auto",children:[e.jsxs(k,{className:"min-w-full",children:[e.jsx(C,{children:e.jsxs(P,{children:[e.jsx(S,{className:"w-1/6",children:ue("programs.program_name")}),e.jsx(S,{className:"w-1/12",children:ue("programs.budget_rm")}),e.jsx(S,{className:"w-1/6",children:ue("programs.recipient_name")}),e.jsx(S,{className:"w-1/8",children:ue("programs.status")}),e.jsx(S,{className:"w-1/8",children:ue("status.voucher_no")}),e.jsx(S,{className:"w-1/8",children:ue("status.eft_no")}),e.jsx(S,{className:"w-1/8",children:ue("programs.created_at")}),e.jsx(S,{className:"w-1/6",children:ue("programs.actions")})]})}),e.jsx(K,{children:sa.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs(P,{className:"bg-gray-50",children:[e.jsx(A,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{variant:"ghost",size:"sm",onClick:()=>{_e(s),De("original"),Pe(!0)},className:"h-6 w-6 p-0",children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx("span",{children:s.program_name||s.programName})]})}),e.jsx(A,{children:s.budget}),e.jsx(A,{children:s.recipient_name||s.recipientName}),e.jsx(A,{children:e.jsx(D,{className:le(s.status||""),children:ue(ce(s.status||""))})}),e.jsx(A,{className:"text-xs",children:s.voucher_number||s.voucherNumber||"-"}),e.jsx(A,{className:"text-xs",children:s.eft_number||s.eftNumber||"-"}),e.jsx(A,{children:new Date(s.created_at||s.createdAt).toLocaleDateString()}),e.jsx(A,{children:e.jsxs("div",{className:"flex gap-2",children:["exco_user"===(null==oe?void 0:oe.role)&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),be(!0)},title:"Remarks",children:e.jsx(Y,{className:"h-4 w-4"})}),("admin"===(null==oe?void 0:oe.role)||"finance_officer"===(null==oe?void 0:oe.role)||"super_admin"===(null==oe?void 0:oe.role))&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),be(!0)},title:"Remarks",children:e.jsx(Y,{className:"h-4 w-4"})}),$s&&"query"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),De("original"),ke(!0)},children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),be(!0)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s);try{const e=s.queries&&Array.isArray(s.queries)?s.queries.find(e=>e&&!e.answered):null;e&&e.question?(Le(e),Re(!0)):ze(!0)}catch(e){ze(!0)}},children:e.jsx(G,{className:"h-4 w-4"})})]}),$s&&"query_answered"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),De("original"),ke(!0)},children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),be(!0)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),ze(!0)},children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{Ks(s),zs(!0)},children:e.jsx(J,{className:"h-4 w-4"})})]}),$s&&"under_review"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),De("original"),ke(!0)},children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),be(!0)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),ze(!0)},children:e.jsx(G,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{Ks(s),zs(!0)},children:e.jsx(H,{className:"h-4 w-4"})})]}),$s&&"complete_can_send_to_mmk"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),De("original"),ke(!0)},children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),be(!0)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{ms(s),xs(!0)},children:e.jsx(J,{className:"h-4 w-4"})})]}),$s&&"under_review_by_mmk"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),De("original"),ke(!0)},children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),be(!0)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{hs(s),js(!0)},children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{Ps(s),Ds(!0)},children:e.jsx(V,{className:"h-4 w-4"})})]}),$s&&"document_accepted_by_mmk"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),De("original"),ke(!0)},children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),be(!0)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{fs(s),_s(!0)},children:e.jsx(J,{className:"h-4 w-4"})})]}),$s&&"payment_in_progress"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),De("original"),ke(!0)},children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),be(!0)},children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{bs(s),ks(!0)},children:e.jsx(H,{className:"h-4 w-4"})})]}),$s&&"payment_completed"===s.status&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),De("original"),ke(!0)},children:e.jsx(X,{className:"h-4 w-4"})}),$s&&"rejected"===s.status&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),De("original"),ke(!0)},children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{_e(s),be(!0)},children:e.jsx(Y,{className:"h-4 w-4"})})]}),Ls&&"draft"===(s.status||s.status)&&e.jsxs(e.Fragment,{children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{var e;_e(s);const a=(e=>{const s={suratAkuanPusatKhidmat:null,suratKelulusanPkn:null,suratProgram:null,suratExco:null,penyataAkaunBank:null,borangDaftarKod:null};return e.documents&&Array.isArray(e.documents)&&e.documents.forEach(e=>{const a=e.original_name||e.name;a.includes("Surat Akuan Pusat Khidmat")?s.suratAkuanPusatKhidmat=e:a.includes("Surat Kelulusan Pkn")?s.suratKelulusanPkn=e:a.includes("Surat Program")?s.suratProgram=e:a.includes("Surat Exco")?s.suratExco=e:a.includes("Penyata Akaun Bank")?s.penyataAkaunBank=e:a.includes("Borang Daftar Kod")&&(s.borangDaftarKod=e)}),s})(s);Ze({programName:s.program_name||s.programName,budget:(null==(e=s.budget)?void 0:e.toString())||"",recipientName:s.recipient_name||s.recipientName,excoLetterRef:s.exco_letter_ref||s.excoLetterRef,suratAkuanPusatKhidmat:null,suratKelulusanPkn:null,suratProgram:null,suratExco:null,penyataAkaunBank:null,borangDaftarKod:null,...a}),fe(!0)},children:e.jsx(W,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{ls(s),ds(!0)},children:e.jsx(J,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{ts(s),ns(!0)},children:e.jsx(Z,{className:"h-4 w-4"})})]})]})})]},s.id),"exco_user"===(null==oe?void 0:oe.role)&&e.jsx(P,{className:"border-t-0",children:e.jsx(A,{colSpan:8,className:"p-0 border-t-0",children:e.jsx(ta,{program:s})})})]}))})]}),"exco_user"===(null==oe?void 0:oe.role)&&Ws>1&&e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-t",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",ea+1," to ",Math.min(Zs,Hs.length)," of ",Hs.length," programs"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:()=>Rs(e=>Math.max(e-1,1)),disabled:1===Bs,children:"Previous"}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Ws},(e,s)=>s+1).map(s=>e.jsx(l,{variant:Bs===s?"default":"outline",size:"sm",onClick:()=>Rs(s),className:"w-8 h-8 p-0",children:s},s))}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>Rs(e=>Math.min(e+1,Ws)),disabled:Bs===Ws,children:"Next"})]})]})]})]})]})]}),e.jsx(F,{open:we,onOpenChange:ke,children:e.jsxs(B,{className:"max-w-4xl",children:[e.jsx(R,{children:e.jsxs(M,{children:["Documents - ",(null==ye?void 0:ye.program_name)||(null==ye?void 0:ye.programName)]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"border-b",children:e.jsx("div",{className:"flex space-x-8",children:e.jsxs("button",{onClick:()=>De("original"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("original"===Ae?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Original Documents",(null==ye?void 0:ye.documents)&&e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs",children:ye.documents.filter(e=>"original"===e.document_type||!e.document_type).length})]})})}),"original"===Ae&&e.jsx("div",{children:(null==ye?void 0:ye.documents)&&ye.documents.filter(e=>"original"===e.document_type||!e.document_type).length>0?ye.documents.filter(e=>"original"===e.document_type||!e.document_type).map(s=>{const a=s.original_name&&/\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(s.original_name);return e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded mb-2",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:s.original_name}),s.uploaded_by&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Uploaded by: ",s.uploaded_by]})]}),e.jsxs("div",{className:"flex gap-1",children:[a&&e.jsx(l,{variant:"outline",size:"sm",onClick:async()=>{try{await d(s.id,s.original_name);me({title:"Success",description:"Image opened in new tab"})}catch(e){me({title:"Error",description:"Failed to view image. Please try again.",variant:"destructive"})}},children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:async()=>{try{await o(s.id,s.original_name),me({title:"Success",description:"Document downloaded successfully"})}catch(e){me({title:"Error",description:"Failed to download document. Please try again.",variant:"destructive"})}},children:e.jsx(se,{className:"h-4 w-4"})})]})]},s.id)}):e.jsx("p",{className:"text-muted-foreground",children:"No original documents uploaded yet."})}),(null==ye?void 0:ye.signedDocuments)&&ye.signedDocuments.length>0&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Signed Documents"}),ye.signedDocuments.map(s=>e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{children:s.name}),e.jsx(l,{variant:"outline",size:"sm",className:"ml-auto",children:e.jsx(X,{className:"h-4 w-4"})})]},s.id))]})]})]})}),e.jsx(F,{open:Ne,onOpenChange:be,children:e.jsxs(B,{className:"max-w-2xl",children:[e.jsx(R,{children:e.jsxs(M,{children:["Program Details - ",(null==ye?void 0:ye.program_name)||(null==ye?void 0:ye.programName)]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{children:"Budget"}),e.jsxs("p",{className:"font-medium",children:["RM ",(null==ye?void 0:ye.budget)||(null==ye?void 0:ye.budget)]})]}),e.jsxs("div",{children:[e.jsx(E,{children:"Recipient"}),e.jsx("p",{className:"font-medium",children:(null==ye?void 0:ye.recipient_name)||(null==ye?void 0:ye.recipientName)})]}),e.jsxs("div",{children:[e.jsx(E,{children:"Letter Reference"}),e.jsx("p",{className:"font-medium",children:(null==ye?void 0:ye.exco_letter_ref)||(null==ye?void 0:ye.excoLetterRef)})]}),e.jsxs("div",{children:[e.jsx(E,{children:"Status"}),e.jsx(D,{className:le((null==ye?void 0:ye.status)||""),children:ue(ce((null==ye?void 0:ye.status)||""))})]})]}),e.jsxs("div",{children:[e.jsx(E,{children:"Remarks"}),e.jsx("div",{className:"space-y-2 max-h-32 overflow-y-auto",children:null==(de=null==ye?void 0:ye.remarks)?void 0:de.map(s=>e.jsxs("div",{className:"p-2 border rounded bg-muted",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-semibold text-sm text-blue-600",children:s.created_by||s.createdBy})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[new Date(s.created_at||s.createdAt).toLocaleDateString()," at ",new Date(s.created_at||s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("p",{className:"text-sm",children:s.remark||s.message})]},s.id))}),e.jsxs("div",{className:"mt-4",children:[e.jsx(z,{placeholder:"Add a remark...",value:es,onChange:e=>ss(e.target.value)}),e.jsx(l,{className:"mt-2",onClick:async()=>{if(es.trim()&&ye){const e=await m(ye.id,es,(null==oe?void 0:oe.fullName)||(null==oe?void 0:oe.full_name)||"",(null==oe?void 0:oe.role)||"");e.success?(me({title:"Success",description:"Remark added"}),"exco_user"===(null==oe?void 0:oe.role)?Js(oe.id):Us?Js(Us.id):u().then(e=>{e.success&&e.programs&&he(e.programs)}),ss(""),_e({...ye,remarks:[...ye.remarks,{id:Date.now().toString(),message:es,createdBy:(null==oe?void 0:oe.fullName)||"",createdAt:(new Date).toISOString().split("T")[0],role:(null==oe?void 0:oe.role)||""}]})):me({title:"Error",description:e.message||"Failed to add remark",variant:"destructive"})}},children:"Add Remark"})]})]})]})]})}),e.jsx(F,{open:ve,onOpenChange:fe,children:e.jsxs(B,{className:"max-w-2xl max-h-[90vh]",children:[e.jsx(R,{children:e.jsx(M,{children:"Edit Program"})}),e.jsxs("div",{className:"space-y-4 overflow-y-auto max-h-[calc(90vh-120px)] pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"edit-program-name",children:"Program Name"}),e.jsx(c,{id:"edit-program-name",value:We.programName,onChange:e=>Ze({...We,programName:e.target.value}),placeholder:"Enter program name"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"edit-budget",children:"Budget (RM)"}),e.jsx(c,{id:"edit-budget",type:"number",value:We.budget,onChange:e=>Ze({...We,budget:e.target.value}),placeholder:"Enter budget amount"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"edit-recipient",children:"Recipient Name"}),e.jsx(c,{id:"edit-recipient",value:We.recipientName,onChange:e=>Ze({...We,recipientName:e.target.value}),placeholder:"Enter recipient name"})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"edit-letter-ref",children:"EXCO Letter Reference"}),e.jsx(c,{id:"edit-letter-ref",value:We.excoLetterRef,onChange:e=>Ze({...We,excoLetterRef:e.target.value}),placeholder:"Enter letter reference"})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx(E,{className:"text-base font-semibold mb-3",children:"Documents"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"text-sm font-medium min-w-[200px]",children:"Surat Akuan Pusat Khidmat"}),e.jsx("div",{className:"flex-1",children:We.suratAkuanPusatKhidmat&&"object"==typeof We.suratAkuanPusatKhidmat&&"id"in We.suratAkuanPusatKhidmat?e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-gray-50",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-sm",children:We.suratAkuanPusatKhidmat.original_name||We.suratAkuanPusatKhidmat.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:async()=>{try{await o(We.suratAkuanPusatKhidmat.id,We.suratAkuanPusatKhidmat.original_name||We.suratAkuanPusatKhidmat.name),me({title:"Success",description:"Document downloaded successfully"})}catch(e){me({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{aa(We.suratAkuanPusatKhidmat.id),Ze({...We,suratAkuanPusatKhidmat:null})},children:e.jsx(Z,{className:"h-4 w-4"})})]})]}):e.jsx(c,{type:"file",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&Ze({...We,suratAkuanPusatKhidmat:a})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"})}),We.suratAkuanPusatKhidmat&&"object"==typeof We.suratAkuanPusatKhidmat&&!("id"in We.suratAkuanPusatKhidmat)&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{Ze({...We,suratAkuanPusatKhidmat:null})},children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"text-sm font-medium min-w-[200px]",children:"Surat Kelulusan Pkn"}),e.jsx("div",{className:"flex-1",children:We.suratKelulusanPkn&&"object"==typeof We.suratKelulusanPkn&&"id"in We.suratKelulusanPkn?e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-gray-50",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-sm",children:We.suratKelulusanPkn.original_name||We.suratKelulusanPkn.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:async()=>{try{await o(We.suratKelulusanPkn.id,We.suratKelulusanPkn.original_name||We.suratKelulusanPkn.name),me({title:"Success",description:"Document downloaded successfully"})}catch(e){me({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{aa(We.suratKelulusanPkn.id),Ze({...We,suratKelulusanPkn:null})},children:e.jsx(Z,{className:"h-4 w-4"})})]})]}):e.jsx(c,{type:"file",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&Ze({...We,suratKelulusanPkn:a})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"})}),We.suratKelulusanPkn&&"object"==typeof We.suratKelulusanPkn&&!("id"in We.suratKelulusanPkn)&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{Ze({...We,suratKelulusanPkn:null})},children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"text-sm font-medium min-w-[200px]",children:"Surat Program"}),e.jsx("div",{className:"flex-1",children:We.suratProgram&&"object"==typeof We.suratProgram&&"id"in We.suratProgram?e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-gray-50",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-sm",children:We.suratProgram.original_name||We.suratProgram.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:async()=>{try{await o(We.suratProgram.id,We.suratProgram.original_name||We.suratProgram.name),me({title:"Success",description:"Document downloaded successfully"})}catch(e){me({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{aa(We.suratProgram.id),Ze({...We,suratProgram:null})},children:e.jsx(Z,{className:"h-4 w-4"})})]})]}):e.jsx(c,{type:"file",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&Ze({...We,suratProgram:a})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"})}),We.suratProgram&&"object"==typeof We.suratProgram&&!("id"in We.suratProgram)&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{Ze({...We,suratProgram:null})},children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"text-sm font-medium min-w-[200px]",children:"Surat Exco"}),e.jsx("div",{className:"flex-1",children:We.suratExco&&"object"==typeof We.suratExco&&"id"in We.suratExco?e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-gray-50",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-sm",children:We.suratExco.original_name||We.suratExco.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:async()=>{try{await o(We.suratExco.id,We.suratExco.original_name||We.suratExco.name),me({title:"Success",description:"Document downloaded successfully"})}catch(e){me({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{aa(We.suratExco.id),Ze({...We,suratExco:null})},children:e.jsx(Z,{className:"h-4 w-4"})})]})]}):e.jsx(c,{type:"file",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&Ze({...We,suratExco:a})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"})}),We.suratExco&&"object"==typeof We.suratExco&&!("id"in We.suratExco)&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{Ze({...We,suratExco:null})},children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"text-sm font-medium min-w-[200px]",children:"Penyata Akaun Bank"}),e.jsx("div",{className:"flex-1",children:We.penyataAkaunBank&&"object"==typeof We.penyataAkaunBank&&"id"in We.penyataAkaunBank?e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-gray-50",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-sm",children:We.penyataAkaunBank.original_name||We.penyataAkaunBank.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:async()=>{try{await o(We.penyataAkaunBank.id,We.penyataAkaunBank.original_name||We.penyataAkaunBank.name),me({title:"Success",description:"Document downloaded successfully"})}catch(e){me({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{aa(We.penyataAkaunBank.id),Ze({...We,penyataAkaunBank:null})},children:e.jsx(Z,{className:"h-4 w-4"})})]})]}):e.jsx(c,{type:"file",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&Ze({...We,penyataAkaunBank:a})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"})}),We.penyataAkaunBank&&"object"==typeof We.penyataAkaunBank&&!("id"in We.penyataAkaunBank)&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{Ze({...We,penyataAkaunBank:null})},children:e.jsx(V,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(E,{className:"text-sm font-medium min-w-[200px]",children:"Borang Daftar Kod"}),e.jsx("div",{className:"flex-1",children:We.borangDaftarKod&&"object"==typeof We.borangDaftarKod&&"id"in We.borangDaftarKod?e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-gray-50",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-sm",children:We.borangDaftarKod.original_name||We.borangDaftarKod.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(l,{variant:"outline",size:"sm",onClick:async()=>{try{await o(We.borangDaftarKod.id,We.borangDaftarKod.original_name||We.borangDaftarKod.name),me({title:"Success",description:"Document downloaded successfully"})}catch(e){me({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{aa(We.borangDaftarKod.id),Ze({...We,borangDaftarKod:null})},children:e.jsx(Z,{className:"h-4 w-4"})})]})]}):e.jsx(c,{type:"file",onChange:e=>{var s;const a=null==(s=e.target.files)?void 0:s[0];a&&Ze({...We,borangDaftarKod:a})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"})}),We.borangDaftarKod&&"object"==typeof We.borangDaftarKod&&!("id"in We.borangDaftarKod)&&e.jsx(l,{variant:"outline",size:"sm",onClick:()=>{Ze({...We,borangDaftarKod:null})},children:e.jsx(V,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{children:[e.jsx(E,{children:"Remarks"}),e.jsxs("div",{className:"space-y-2",children:[(null==ye?void 0:ye.remarks)&&ye.remarks.length>0&&e.jsx("div",{className:"border rounded p-2 space-y-1 max-h-32 overflow-y-auto",children:ye.remarks.map(s=>e.jsxs("div",{className:"p-2 border rounded bg-muted",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-semibold text-sm text-blue-600",children:s.created_by||s.createdBy})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[new Date(s.created_at||s.createdAt).toLocaleDateString()," at ",new Date(s.created_at||s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("p",{className:"text-sm",children:s.remark||s.message})]},s.id))}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(z,{placeholder:"Add a remark...",value:es,onChange:e=>ss(e.target.value)}),e.jsx(l,{size:"sm",onClick:async()=>{if(es.trim()&&ye){const e=await m(ye.id,es,(null==oe?void 0:oe.fullName)||(null==oe?void 0:oe.full_name)||"",(null==oe?void 0:oe.role)||"");if(e.success){if(me({title:"Success",description:"Remark added"}),"exco_user"===(null==oe?void 0:oe.role))Js(oe.id);else if(Us)Js(Us.id);else{const e=await u();e.success&&he(e.programs)}if("exco_user"===(null==oe?void 0:oe.role)){const e=await fetch(`${i}/programs.php?exco_user_id=${oe.id}`),s=await e.json();if(s.success){const e=s.programs.find(e=>e.id===ye.id);e&&_e(e)}}else if(Us){const e=await fetch(`${i}/programs.php?exco_user_id=${Us.id}`),s=await e.json();if(s.success){const e=s.programs.find(e=>e.id===ye.id);e&&_e(e)}}else{const e=await u();if(e.success){const s=e.programs.find(e=>e.id===ye.id);s&&_e(s)}}ss("")}else me({title:"Error",description:e.message||"Failed to add remark",variant:"destructive"})}},children:"Add Remark"})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4 border-t",children:[e.jsx(l,{variant:"outline",onClick:()=>fe(!1),children:"Cancel"}),e.jsx(l,{onClick:async()=>{var e;if(!(We.programName&&We.budget&&We.recipientName&&We.excoLetterRef))return void me({title:ue("common.error"),description:ue("programs.fill_required_fields"),variant:"destructive"});if(!ye)return;const s={program_name:We.programName,budget:parseFloat(We.budget),recipient_name:We.recipientName,exco_letter_ref:We.excoLetterRef},a=await j(ye.id,s);if(a.success){const s=[{field:"suratAkuanPusatKhidmat",name:"Surat Akuan Pusat Khidmat"},{field:"suratKelulusanPkn",name:"Surat Kelulusan Pkn"},{field:"suratProgram",name:"Surat Program"},{field:"suratExco",name:"Surat Exco"},{field:"penyataAkaunBank",name:"Penyata Akaun Bank"},{field:"borangDaftarKod",name:"Borang Daftar Kod"}],a=Date.now();for(const r of s){const s=We[r.field];if(s)try{const t=ye.id,n=s.name.split(".").pop(),i=null==(e=ye.documents)?void 0:e.find(e=>(e.original_name||e.name).includes(r.name));i&&await v(i.id);const l=`${r.name}(${t})(edit${a}).${n}`,c=new File([s],l,{type:s.type});await g(t,c)}catch(t){me({title:ue("common.error"),description:`Failed to upload ${r.name}`,variant:"destructive"})}}me({title:ue("common.success"),description:ue("programs.updated_successfully")}),"exco_user"===(null==oe?void 0:oe.role)?Js(oe.id):Us?Js(Us.id):u().then(e=>{e.success&&e.programs&&he(e.programs)}),fe(!1),_e(null),Ze({programName:"",budget:"",recipientName:"",excoLetterRef:"",suratAkuanPusatKhidmat:null,suratKelulusanPkn:null,suratProgram:null,suratExco:null,penyataAkaunBank:null,borangDaftarKod:null})}else me({title:ue("common.error"),description:a.message||ue("programs.update_failed"),variant:"destructive"})},children:"Update Program"})]})]})]})}),e.jsx(F,{open:rs,onOpenChange:ns,children:e.jsxs(B,{children:[e.jsx(R,{children:e.jsx(M,{children:"Delete Program"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:['Are you sure you want to delete the program "',(null==as?void 0:as.program_name)||(null==as?void 0:as.programName),'"?']}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This will permanently delete:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground list-disc list-inside space-y-1",children:[e.jsx("li",{children:"The program and all its data"}),e.jsx("li",{children:"All associated documents and files"}),e.jsx("li",{children:"All remarks and queries"})]}),e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{ns(!1),ts(null)},children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:async()=>{try{const e=await x(as.id);if(e.success)if(me({title:"Success",description:"Program deleted successfully"}),"exco_user"===(null==oe?void 0:oe.role))Js(oe.id);else{const e=await u();e.success&&he(e.programs)}else me({title:"Error",description:e.message||"Failed to delete program",variant:"destructive"})}catch(e){me({title:"Error",description:"Failed to delete program. Please try again.",variant:"destructive"})}finally{ns(!1),ts(null)}},children:"Delete Program"})]})]})]})}),e.jsx(F,{open:cs,onOpenChange:ds,children:e.jsxs(B,{children:[e.jsx(R,{children:e.jsx(M,{children:"Submit Program for Review"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:['Are you sure you want to submit the program "',(null==is?void 0:is.program_name)||(null==is?void 0:is.programName),'" for review?']}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This will:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground list-disc list-inside space-y-1",children:[e.jsx("li",{children:'Change the program status to "Under Review"'}),e.jsx("li",{children:"Send the program to Finance for approval"}),e.jsx("li",{children:"Lock the program from further editing"})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{ds(!1),ls(null)},children:"Cancel"}),e.jsx(l,{onClick:()=>(async e=>{const s=await p(e,"under_review");s.success?(me({title:ue("common.success"),description:ue("programs.submitted_for_review")}),"exco_user"===(null==oe?void 0:oe.role)?Js(oe.id):Us?Js(Us.id):u().then(e=>{e.success&&e.programs&&he(e.programs)}),ds(!1),ls(null)):me({title:ue("common.error"),description:s.message||ue("programs.submit_failed"),variant:"destructive"})})(is.id),children:"Submit for Review"})]})]})]})}),e.jsx(F,{open:us,onOpenChange:xs,children:e.jsxs(B,{children:[e.jsx(R,{children:e.jsx(M,{children:"Submit to MMK Office"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:['Are you sure you want to submit the program "',(null==os?void 0:os.program_name)||(null==os?void 0:os.programName),'" to MMK office for review?']}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'This will change the program status to "Under Review by MMK office".'}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{xs(!1),ms(null)},children:"Cancel"}),e.jsx(l,{onClick:()=>(async e=>{const s=await p(e,"under_review_by_mmk");s.success?(me({title:ue("common.success"),description:"Program submitted to MMK office for review"}),"exco_user"===(null==oe?void 0:oe.role)?Js(oe.id):Us?Js(Us.id):u().then(e=>{e.success&&e.programs&&he(e.programs)}),xs(!1),ms(null)):me({title:"Error",description:s.message||"Failed to submit program to MMK",variant:"destructive"})})(os.id),children:"Submit to MMK"})]})]})]})}),e.jsx(F,{open:gs,onOpenChange:js,children:e.jsxs(B,{children:[e.jsx(R,{children:e.jsx(M,{children:"Accept Document"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:['Are you sure you want to accept the document for program "',(null==ps?void 0:ps.program_name)||(null==ps?void 0:ps.programName),'"?']}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'This will change the program status to "Document Accepted by MMK Office".'}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{js(!1),hs(null)},children:"Cancel"}),e.jsx(l,{onClick:()=>(async e=>{const s=await p(e,"document_accepted_by_mmk");s.success?(me({title:ue("common.success"),description:"Document accepted by MMK office"}),"exco_user"===(null==oe?void 0:oe.role)?Js(oe.id):Us?Js(Us.id):u().then(e=>{e.success&&e.programs&&he(e.programs)}),js(!1),hs(null)):me({title:"Error",description:s.message||"Failed to approve document",variant:"destructive"})})(ps.id),children:"Accept Document"})]})]})]})}),e.jsx(F,{open:ys,onOpenChange:_s,children:e.jsxs(B,{children:[e.jsx(R,{children:e.jsx(M,{children:"Start Payment Process"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:['Are you sure you want to start the payment process for program "',(null==vs?void 0:vs.program_name)||(null==vs?void 0:vs.programName),'"?']}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'This will change the program status to "Payment in Progress".'}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{_s(!1),fs(null)},children:"Cancel"}),e.jsx(l,{onClick:()=>(async e=>{const s=await p(e,"payment_in_progress");s.success?(me({title:ue("common.success"),description:"Payment process started"}),"exco_user"===(null==oe?void 0:oe.role)?Js(oe.id):Us?Js(Us.id):u().then(e=>{e.success&&e.programs&&he(e.programs)}),_s(!1),fs(null)):me({title:"Error",description:s.message||"Failed to start payment process",variant:"destructive"})})(vs.id),children:"Start Payment"})]})]})]})}),e.jsx(F,{open:ws,onOpenChange:ks,children:e.jsxs(B,{children:[e.jsx(R,{children:e.jsx(M,{children:"Complete Payment"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:['Complete payment for program "',(null==Ns?void 0:Ns.program_name)||(null==Ns?void 0:Ns.programName),'"']}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please enter the voucher and EFT numbers to complete the payment."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"voucherNumber",children:"Voucher Number *"}),e.jsx(c,{id:"voucherNumber",placeholder:"Enter voucher number (e.g., V2024001)",value:Ve,onChange:e=>Xe(e.target.value)})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"eftNumber",children:"EFT Number *"}),e.jsx(c,{id:"eftNumber",placeholder:"Enter EFT number (e.g., EFT2024001)",value:Ye,onChange:e=>Ge(e.target.value)})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{ks(!1),bs(null),Xe(""),Ge("")},children:"Cancel"}),e.jsx(l,{onClick:()=>{Ve.trim()&&Ye.trim()?((async(e,s,a)=>{const t=await p(e,"payment_completed",s,a);t.success?(me({title:ue("common.success"),description:"Payment completed successfully"}),"exco_user"===(null==oe?void 0:oe.role)?Js(oe.id):Us?Js(Us.id):u().then(e=>{e.success&&e.programs&&he(e.programs)}),ks(!1),bs(null)):me({title:"Error",description:t.message||"Failed to complete payment",variant:"destructive"})})(Ns.id,Ve.trim(),Ye.trim()),Xe(""),Ge("")):me({title:"Error",description:"Please enter both voucher number and EFT number",variant:"destructive"})},children:"Complete Payment"})]})]})]})}),e.jsx(F,{open:As,onOpenChange:Ds,children:e.jsxs(B,{children:[e.jsx(R,{children:e.jsx(M,{children:"Reject Program"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:['Are you sure you want to reject the program "',(null==Cs?void 0:Cs.program_name)||(null==Cs?void 0:Cs.programName),'"?']}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This will:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground list-disc list-inside space-y-1",children:[e.jsx("li",{children:'Change the program status to "Rejected"'}),e.jsx("li",{children:"Return the program to draft status"}),e.jsx("li",{children:"Allow the program to be resubmitted"})]}),e.jsx("p",{className:"text-sm text-red-600 font-medium",children:"The program creator will be notified of the rejection."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{Ds(!1),Ps(null)},children:"Cancel"}),e.jsx(l,{variant:"destructive",onClick:()=>(async e=>{const s=await p(e,"rejected");s.success?(me({title:ue("programs.rejected"),description:ue("programs.rejected_successfully")}),"exco_user"===(null==oe?void 0:oe.role)?Js(oe.id):Us?Js(Us.id):u().then(e=>{e.success&&e.programs&&he(e.programs)}),Ds(!1),Ps(null)):me({title:"Error",description:s.message||"Failed to reject program",variant:"destructive"})})(Cs.id),children:"Reject Program"})]})]})]})}),e.jsx(F,{open:Es,onOpenChange:zs,children:e.jsxs(B,{children:[e.jsx(R,{children:e.jsx(M,{children:"Complete & Send to MMK"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("p",{children:['Are you sure you want to mark the program "',(null==Ss?void 0:Ss.program_name)||(null==Ss?void 0:Ss.programName),'" as complete and send it to MMK office?']}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"This will:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground list-disc list-inside space-y-1",children:[e.jsx("li",{children:'Change the program status to "Complete & Send to MMK"'}),e.jsx("li",{children:"Allow the program to be submitted to MMK office"}),e.jsx("li",{children:"Enable the next step in the approval process"})]}),e.jsx("p",{className:"text-sm text-blue-600 font-medium",children:"The program will be ready for MMK office review."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{zs(!1),Ks(null)},children:"Cancel"}),e.jsx(l,{variant:"default",onClick:()=>{p(Ss.id,"complete_can_send_to_mmk").then(e=>{e.success?(me({title:ue("common.success"),description:"Program status updated to Complete & Send to MMK"}),"exco_user"===(null==oe?void 0:oe.role)?Js(oe.id):Us?Js(Us.id):u().then(e=>{e.success&&e.programs&&he(e.programs)})):me({title:ue("common.error"),description:e.message||"Failed to update status",variant:"destructive"})}),zs(!1),Ks(null)},children:"Complete & Send to MMK"})]})]})]})}),e.jsx(F,{open:Ce,onOpenChange:Pe,children:e.jsxs(B,{className:"max-w-2xl max-h-[90vh]",children:[e.jsx(R,{children:e.jsxs(M,{children:["Program Details - ",(null==ye?void 0:ye.program_name)||(null==ye?void 0:ye.programName)]})}),e.jsxs("div",{className:"space-y-4 overflow-y-auto max-h-[calc(90vh-120px)] pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"Program Name"}),e.jsx("p",{className:"font-medium",children:(null==ye?void 0:ye.program_name)||(null==ye?void 0:ye.programName)})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"Budget (RM)"}),e.jsxs("p",{className:"font-medium",children:["RM ",(null==ye?void 0:ye.budget)||(null==ye?void 0:ye.budget)]})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"Recipient Name"}),e.jsx("p",{className:"font-medium",children:(null==ye?void 0:ye.recipient_name)||(null==ye?void 0:ye.recipientName)})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"EXCO Letter Reference"}),e.jsx("p",{className:"font-medium",children:(null==ye?void 0:ye.exco_letter_ref)||(null==ye?void 0:ye.excoLetterRef)})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(D,{className:le((null==ye?void 0:ye.status)||""),children:ue(ce((null==ye?void 0:ye.status)||""))})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"Created By"}),e.jsx("p",{className:"font-medium",children:Qe[(null==ye?void 0:ye.created_by)||(null==ye?void 0:ye.createdBy)]||(null==ye?void 0:ye.created_by)||(null==ye?void 0:ye.createdBy)})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"Created Date"}),e.jsx("p",{className:"font-medium",children:new Date((null==ye?void 0:ye.created_at)||(null==ye?void 0:ye.createdAt)).toLocaleDateString()})]}),(null==ye?void 0:ye.voucher_number)&&e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"Voucher Number"}),e.jsx("p",{className:"font-medium",children:ye.voucher_number})]}),(null==ye?void 0:ye.eft_number)&&e.jsxs("div",{children:[e.jsx(E,{className:"text-sm font-medium text-muted-foreground",children:"EFT Number"}),e.jsx("p",{className:"font-medium",children:ye.eft_number})]})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-base font-semibold",children:"Documents"}),e.jsx("div",{className:"border-b mt-2",children:e.jsx("div",{className:"flex space-x-8",children:e.jsxs("button",{onClick:()=>De("original"),className:"py-2 px-1 border-b-2 font-medium text-sm "+("original"===Ae?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Original Documents",(null==ye?void 0:ye.documents)&&e.jsx("span",{className:"ml-2 bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs",children:ye.documents.filter(e=>"original"===e.document_type||!e.document_type).length})]})})}),"original"===Ae&&e.jsx("div",{className:"space-y-2 mt-2",children:(null==ye?void 0:ye.documents)&&ye.documents.filter(e=>"original"===e.document_type||!e.document_type).length>0?e.jsx("div",{className:"border rounded p-2 space-y-1",children:ye.documents.filter(e=>"original"===e.document_type||!e.document_type).map(s=>{const a=s.original_name&&/\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(s.original_name);return e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[e.jsx(ee,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:s.original_name||s.name}),s.uploaded_by&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Uploaded by: ",s.uploaded_by]})]}),e.jsxs("div",{className:"flex gap-1",children:[a&&e.jsx(l,{variant:"outline",size:"sm",onClick:async()=>{try{await d(s.id,s.original_name||s.name),me({title:"Success",description:"Document opened in new tab"})}catch(e){me({title:"Error",description:"Failed to view document",variant:"destructive"})}},children:e.jsx(X,{className:"h-4 w-4"})}),e.jsx(l,{variant:"outline",size:"sm",onClick:async()=>{try{await o(s.id,s.original_name||s.name),me({title:"Success",description:"Document downloaded successfully"})}catch(e){me({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(se,{className:"h-4 w-4"})})]})]},s.id)})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No original documents uploaded yet."})})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-base font-semibold",children:"Queries"}),e.jsx("div",{className:"space-y-2",children:(null==ye?void 0:ye.queries)&&ye.queries.length>0?e.jsx("div",{className:"border rounded p-2 space-y-1 max-h-32 overflow-y-auto",children:ye.queries.map(s=>e.jsxs("div",{className:"p-2 border rounded bg-muted",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm text-blue-600",children:s.created_by}),e.jsx(D,{variant:s.answered?"default":"secondary",children:s.answered?"Answered":"Pending"})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[new Date(s.created_at).toLocaleDateString()," at ",new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("p",{className:"text-sm font-medium",children:["Q: ",s.question]}),s.answer&&e.jsx("div",{className:"mt-2 p-2 bg-white rounded border-l-4 border-green-500",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"A:"})," ",s.answer]})}),!s.answered&&"exco_user"===(null==oe?void 0:oe.role)&&e.jsx(l,{size:"sm",variant:"outline",className:"mt-2",onClick:()=>{Le(s),qe(!0)},children:"Answer Query"})]},s.id))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No queries yet."})})]}),e.jsxs("div",{children:[e.jsx(E,{className:"text-base font-semibold",children:"Remarks"}),e.jsx("div",{className:"space-y-2",children:(null==ye?void 0:ye.remarks)&&ye.remarks.length>0?e.jsx("div",{className:"border rounded p-2 space-y-1 max-h-32 overflow-y-auto",children:ye.remarks.map(s=>e.jsxs("div",{className:"p-2 border rounded bg-muted",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-semibold text-sm text-blue-600",children:s.created_by||s.createdBy})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[new Date(s.created_at||s.createdAt).toLocaleDateString()," at ",new Date(s.created_at||s.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("p",{className:"text-sm",children:s.remark||s.message})]},s.id))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No remarks yet."})})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsx(l,{variant:"outline",onClick:()=>Pe(!1),children:"Close"})})]})]})}),e.jsx(F,{open:Ee,onOpenChange:ze,children:e.jsxs(B,{children:[e.jsx(R,{children:e.jsxs(M,{children:["Submit Query - ",(null==ye?void 0:ye.program_name)||(null==ye?void 0:ye.programName)]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(E,{htmlFor:"query",children:"Query"}),e.jsx(z,{id:"query",placeholder:"Enter your query about missing documents or any other concerns...",value:$e,onChange:e=>Oe(e.target.value),rows:4})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{ze(!1),Oe("")},children:"Cancel"}),e.jsx(l,{onClick:async()=>{if($e.trim())if(ye)try{const e=await f(ye.id,$e.trim(),(null==oe?void 0:oe.fullName)||(null==oe?void 0:oe.full_name)||"");if(e.success){if(me({title:ue("common.success"),description:ue("programs.query_submitted")}),"exco_user"===(null==oe?void 0:oe.role))Js(oe.id);else if(Us)Js(Us.id);else{const e=await u();e.success&&he(e.programs)}if("exco_user"===(null==oe?void 0:oe.role)){const e=await fetch(`${i}/programs.php?exco_user_id=${oe.id}`),s=await e.json();if(s.success){const e=s.programs.find(e=>e.id===ye.id);e&&_e(e)}}else if(Us){const e=await fetch(`${i}/programs.php?exco_user_id=${Us.id}`),s=await e.json();if(s.success){const e=s.programs.find(e=>e.id===ye.id);e&&_e(e)}}else{const e=await u();if(e.success){const s=e.programs.find(e=>e.id===ye.id);s&&_e(s)}}Oe(""),ze(!1)}else me({title:ue("common.error"),description:e.message||ue("programs.query_submit_failed"),variant:"destructive"})}catch(e){me({title:ue("common.error"),description:ue("programs.query_submit_failed"),variant:"destructive"})}else me({title:ue("common.error"),description:ue("programs.no_program_selected"),variant:"destructive"});else me({title:ue("common.error"),description:ue("programs.enter_query"),variant:"destructive"})},children:"Submit Query"})]})]})]})}),e.jsx(F,{open:Be,onOpenChange:Re,children:e.jsxs(B,{children:[e.jsx(R,{children:e.jsxs(M,{children:["Current Query - ",(null==ye?void 0:ye.program_name)||(null==ye?void 0:ye.programName)]})}),e.jsxs("div",{className:"space-y-4",children:[Me&&Me.question&&e.jsxs("div",{children:[e.jsx(E,{children:"Query Details"}),e.jsxs("div",{className:"p-4 border rounded bg-muted",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Query:"}),e.jsx("p",{className:"text-sm mt-1",children:Me.question})]}),e.jsx(D,{variant:"secondary",className:"text-xs",children:"Pending"})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[e.jsxs("p",{children:["Asked by: ",Me.created_by||"Unknown"]}),e.jsxs("p",{children:["Date: ",Me.created_at?new Date(Me.created_at).toLocaleDateString():"Unknown"," at ",Me.created_at?new Date(Me.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):"Unknown"]})]})]})]}),e.jsx("div",{className:"flex justify-end gap-2",children:e.jsx(l,{variant:"outline",onClick:()=>{Re(!1),Le(null)},children:"Close"})})]})]})}),e.jsx(F,{open:Fe,onOpenChange:qe,children:e.jsxs(B,{children:[e.jsx(R,{children:e.jsx(M,{children:"Answer Query"})}),e.jsxs("div",{className:"space-y-4",children:[Me&&Me.question&&e.jsxs("div",{children:[e.jsx(E,{children:"Original Query"}),e.jsxs("div",{className:"p-3 border rounded bg-muted",children:[e.jsx("p",{className:"text-sm",children:Me.question}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Asked by: ",Me.created_by||"Unknown"," on ",Me.created_at?new Date(Me.created_at).toLocaleDateString():"Unknown"]})]})]}),e.jsxs("div",{children:[e.jsx(E,{htmlFor:"answer",children:"Answer"}),e.jsx(z,{id:"answer",placeholder:"Enter your answer to the query...",value:Te,onChange:e=>Ue(e.target.value),rows:4})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{variant:"outline",onClick:()=>{qe(!1),Ue(""),Le(null)},children:"Cancel"}),e.jsx(l,{onClick:async()=>{if(Te.trim())if(Me)try{const e=await y(Me.id,Te.trim(),(null==oe?void 0:oe.fullName)||(null==oe?void 0:oe.full_name)||"");if(e.success){if(me({title:ue("common.success"),description:ue("programs.query_answered")}),"exco_user"===(null==oe?void 0:oe.role))Js(oe.id);else if(Us)Js(Us.id);else{const e=await u();e.success&&he(e.programs)}if("exco_user"===(null==oe?void 0:oe.role)){const e=await fetch(`${i}/programs.php?exco_user_id=${oe.id}`),s=await e.json();if(s.success){const e=s.programs.find(e=>e.id===ye.id);e&&_e(e)}}else if(Us){const e=await fetch(`${i}/programs.php?exco_user_id=${Us.id}`),s=await e.json();if(s.success){const e=s.programs.find(e=>e.id===ye.id);e&&_e(e)}}else{const e=await u();if(e.success){const s=e.programs.find(e=>e.id===ye.id);s&&_e(s)}}Ue(""),qe(!1),Le(null)}else me({title:ue("common.error"),description:e.message||ue("programs.answer_query_failed"),variant:"destructive"})}catch(e){me({title:ue("common.error"),description:ue("programs.answer_query_failed"),variant:"destructive"})}else me({title:ue("common.error"),description:ue("programs.no_query_selected"),variant:"destructive"});else me({title:ue("common.error"),description:ue("programs.enter_answer"),variant:"destructive"})},children:"Submit Answer"})]})]})]})})]})}export{de as default};
