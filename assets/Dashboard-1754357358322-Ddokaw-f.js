import{m as e,z as s,j as t,B as a,e as r,E as d,F as n,G as l,n as i}from"./ui-vendor-1754357358322-Bp-UNE15.js";import{r as c}from"./react-vendor-1754357358322-BCu8432v.js";import{C as o,c as m,a as u,b as x}from"./card-1754357358322-jzcAFHNM.js";import{u as p,a as h,b as g,g as f,c as j,S as b,B as N}from"./index-1754357358322-CldQuBx-.js";import{E as y}from"./ExcoUserBudgetTable-1754357358322-DEBx-9LI.js";import{F as v,m as _,n as w,o as C,D as k,W as R,p as S,i as D}from"./icons-vendor-1754357358322-D5w6PadE.js";import"./utils-vendor-1754357358322-CYErry0n.js";import"./query-vendor-1754357358322-D8Bw-8e5.js";import"./table-1754357358322-C8S8WM1D.js";var O="Collapsible",[B,F]=e(O),[$,q]=B(O),E=c.forwardRef((e,d)=>{const{__scopeCollapsible:n,open:l,defaultOpen:i,disabled:o,onOpenChange:m,...u}=e,[x=!1,p]=s({prop:l,defaultProp:i,onChange:m});return t.jsx($,{scope:n,disabled:o,contentId:a(),open:x,onOpenToggle:c.useCallback(()=>p(e=>!e),[p]),children:t.jsx(r.div,{"data-state":P(x),"data-disabled":o?"":void 0,...u,ref:d})})});E.displayName=O;var T="CollapsibleTrigger",A=c.forwardRef((e,s)=>{const{__scopeCollapsible:a,...n}=e,l=q(T,a);return t.jsx(r.button,{type:"button","aria-controls":l.contentId,"aria-expanded":l.open||!1,"data-state":P(l.open),"data-disabled":l.disabled?"":void 0,disabled:l.disabled,...n,ref:s,onClick:d(e.onClick,l.onOpenToggle)})});A.displayName=T;var I="CollapsibleContent",z=c.forwardRef((e,s)=>{const{forceMount:a,...r}=e,d=q(I,e.__scopeCollapsible);return t.jsx(n,{present:a||d.open,children:({present:e})=>t.jsx(M,{...r,ref:s,present:e})})});z.displayName=I;var M=c.forwardRef((e,s)=>{const{__scopeCollapsible:a,present:d,children:n,...o}=e,m=q(I,a),[u,x]=c.useState(d),p=c.useRef(null),h=l(s,p),g=c.useRef(0),f=g.current,j=c.useRef(0),b=j.current,N=m.open||u,y=c.useRef(N),v=c.useRef();return c.useEffect(()=>{const e=requestAnimationFrame(()=>y.current=!1);return()=>cancelAnimationFrame(e)},[]),i(()=>{const e=p.current;if(e){v.current=v.current||{transitionDuration:e.style.transitionDuration,animationName:e.style.animationName},e.style.transitionDuration="0s",e.style.animationName="none";const s=e.getBoundingClientRect();g.current=s.height,j.current=s.width,y.current||(e.style.transitionDuration=v.current.transitionDuration,e.style.animationName=v.current.animationName),x(d)}},[m.open,d]),t.jsx(r.div,{"data-state":P(m.open),"data-disabled":m.disabled?"":void 0,id:m.contentId,hidden:!N,...o,ref:h,style:{"--radix-collapsible-content-height":f?`${f}px`:void 0,"--radix-collapsible-content-width":b?`${b}px`:void 0,...e.style},children:N&&n})});function P(e){return e?"open":"closed"}const Y=E,G=A,J=z;function L(){const{user:e}=p(),{toast:s}=h(),{t:a}=g(),[r,d]=c.useState({total:0,payment_completed:0,rejected:0,pending:0}),[n,l]=c.useState([]),[i,O]=c.useState([]),[B,F]=c.useState(!0),[$,q]=c.useState(null),[E,T]=c.useState({}),[A,I]=c.useState(!1);c.useEffect(()=>{z(),M(),f().then(e=>{if(e.success&&e.users){const s={};e.users.forEach(e=>{s[e.id]=e.fullName||e.full_name||e.email||e.id}),T(s)}})},[e]);const z=async()=>{F(!0);try{const e=await fetch(`${j}/users.php?exco_stats=1`),s=await e.json();s.success&&O(s.users)}catch(e){s({title:a("common.error"),description:"Failed to fetch EXCO users",variant:"destructive"})}finally{F(!1)}},M=async()=>{const s="exco_user"===(null==e?void 0:e.role)&&(null==e?void 0:e.id)?`${j}/dashboard.php?user_id=${e.id}`:`${j}/dashboard.php`,t=await fetch(s),a=await t.json();a.success&&(d(a.stats||{}),l(a.recent_programs||[]))},P=e=>new Intl.NumberFormat("ms-MY",{style:"currency",currency:"MYR"}).format(e),L=e=>{const s={draft:"bg-gray-100 text-gray-800",under_review:"bg-blue-100 text-blue-800",query:"bg-orange-100 text-orange-800",query_answered:"bg-purple-100 text-purple-800",complete_can_send_to_mmk:"bg-yellow-100 text-yellow-800",under_review_by_mmk:"bg-indigo-100 text-indigo-800",document_accepted_by_mmk:"bg-green-100 text-green-800",payment_in_progress:"bg-teal-100 text-teal-800",payment_completed:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"};return s[e]||s.draft};if(B)return t.jsxs("div",{className:"container mx-auto p-6 mobile-zoom-out",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:a("nav.dashboard","Dashboard")}),t.jsx("p",{className:"text-gray-600",children:a("dashboard.description","Overview of program management activities")})]}),t.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:Array.from({length:4}).map((e,s)=>t.jsx(o,{className:"hover:shadow-lg transition-shadow",children:t.jsxs(m,{className:"p-6",children:[t.jsx(b,{className:"h-6 w-24 mb-2"}),t.jsx(b,{className:"h-8 w-16"})]})},s))})]});let U=i.reduce((e,s)=>e+(s.total_budget||0),0),V=i.reduce((e,s)=>e+(s.remaining_budget||0),0);if("exco_user"===(null==e?void 0:e.role)){const s=i.find(s=>s.id===e.id||s.user_id===e.id);U=(null==s?void 0:s.total_budget)||0,V=(null==s?void 0:s.remaining_budget)||0}const W=U-V,X=U>0?W/U*100:0;let H=n,K=r;return t.jsxs("div",{className:"container mx-auto p-6 mobile-zoom-out",children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:a("nav.dashboard","Dashboard")}),t.jsx("p",{className:"text-gray-600",children:a("dashboard.description","Overview of program management activities")})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8",children:[t.jsx(o,{className:"card-elevated",children:t.jsx(m,{className:"p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a("dashboard.total_programs")}),t.jsx("p",{className:"text-3xl font-bold text-foreground",children:K.total})]}),t.jsx("div",{className:"w-12 h-12 bg-primary-light rounded-xl flex items-center justify-center",children:t.jsx(v,{className:"w-6 h-6 text-primary"})})]})})}),t.jsx(o,{className:"card-elevated",children:t.jsx(m,{className:"p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a("dashboard.payment_completed_programs")}),t.jsx("p",{className:"text-3xl font-bold text-success",children:K.payment_completed})]}),t.jsx("div",{className:"w-12 h-12 bg-success-light rounded-xl flex items-center justify-center",children:t.jsx(_,{className:"w-6 h-6 text-success"})})]})})}),t.jsx(o,{className:"card-elevated",children:t.jsx(m,{className:"p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a("dashboard.rejected_programs")}),t.jsx("p",{className:"text-3xl font-bold text-danger",children:K.rejected})]}),t.jsx("div",{className:"w-12 h-12 bg-danger-light rounded-xl flex items-center justify-center",children:t.jsx(w,{className:"w-6 h-6 text-danger"})})]})})}),t.jsx(o,{className:"card-elevated",children:t.jsx(m,{className:"p-6",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:a("dashboard.pending_programs")}),t.jsx("p",{className:"text-3xl font-bold text-warning",children:K.pending})]}),t.jsx("div",{className:"w-12 h-12 bg-warning-light rounded-xl flex items-center justify-center",children:t.jsx(C,{className:"w-6 h-6 text-warning"})})]})})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8",children:[t.jsxs(o,{className:"card-elevated",children:[t.jsx(u,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:t.jsx(x,{className:"text-lg font-semibold",children:a("dashboard.total_budget")})}),t.jsx(m,{children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"w-12 h-12 bg-primary-light rounded-xl flex items-center justify-center",children:t.jsx(k,{className:"w-6 h-6 text-primary"})}),t.jsxs("div",{children:[t.jsx("p",{className:"text-2xl font-bold text-foreground",children:P(U)}),t.jsx("p",{className:"text-sm text-muted-foreground",children:a("dashboard.available_for_programs")})]})]})})]}),t.jsxs(o,{className:"card-elevated",children:[t.jsx(u,{children:t.jsx(x,{className:"text-lg font-semibold",children:a("dashboard.remaining_budget")})}),t.jsx(m,{children:t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsx("div",{className:"w-12 h-12 bg-success-light rounded-xl flex items-center justify-center",children:t.jsx(R,{className:"w-6 h-6 text-success"})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("p",{className:"text-2xl font-bold text-foreground",children:P(V)}),t.jsxs("div",{className:"mt-2",children:[t.jsxs("div",{className:"flex justify-between text-sm text-muted-foreground",children:[t.jsxs("span",{children:[a("dashboard.usage"),": ",X.toFixed(1),"%"]}),t.jsxs("span",{children:[P(W)," ",a("dashboard.used")]})]}),t.jsx("div",{className:"w-full bg-muted rounded-full h-2 mt-1",children:t.jsx("div",{className:"bg-primary h-2 rounded-full transition-all",style:{width:`${X}%`}})})]})]})]})})]})]}),"exco_user"!==(null==e?void 0:e.role)&&t.jsx(o,{className:"card-elevated mb-8",children:t.jsxs(Y,{open:A,onOpenChange:I,children:[t.jsx(u,{className:"pb-2",children:t.jsx(G,{asChild:!0,children:t.jsxs(N,{variant:"ghost",className:"w-full flex items-center justify-between p-0 h-auto",children:[t.jsx(x,{className:"text-lg font-semibold",children:a("exco.users.budgets")}),A?t.jsx(S,{className:"h-5 w-5 text-muted-foreground"}):t.jsx(D,{className:"h-5 w-5 text-muted-foreground"})]})})}),t.jsx(J,{children:t.jsx(m,{children:t.jsx("div",{className:"overflow-x-auto",children:t.jsx(y,{users:i,userRole:(null==e?void 0:e.role)||"",onBudgetChange:async(e,t)=>{q(e);const r={user_id:Number(e),total_budget:Number(t)};try{const e=await fetch(`${j}/users.php?set_budget=1`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),t=await e.json();t.success?(s({title:a("common.success"),description:"Budget updated."}),z()):s({title:a("common.error"),description:t.message||"Failed to update budget",variant:"destructive"})}catch(d){s({title:a("common.error"),description:"Failed to update budget",variant:"destructive"})}finally{q(null)}},showViewButton:!1})})})})]})}),t.jsxs(o,{className:"card-elevated mt-8",children:[t.jsx(u,{children:t.jsx(x,{className:"text-lg font-semibold",children:a("dashboard.recent_programs")})}),t.jsx(m,{children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-border",children:[t.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:a("programs.program_name")}),t.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:a("programs.budget")}),t.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:a("programs.recipient")}),t.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:a("programs.status")}),t.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:a("programs.submitted_by")}),t.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:a("common.date")})]})}),t.jsx("tbody",{children:H.map(e=>{return t.jsxs("tr",{className:"border-b border-border hover:bg-muted/50 transition-fast",children:[t.jsx("td",{className:"py-3 px-4 font-medium text-foreground",children:e.name}),t.jsx("td",{className:"py-3 px-4 text-foreground",children:P(e.budget)}),t.jsx("td",{className:"py-3 px-4 text-muted-foreground",children:e.recipient}),t.jsx("td",{className:"py-3 px-4",children:t.jsx("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${L(e.status)}`,children:a((s=e.status,{draft:"status.draft",under_review:"status.under_review",query:"status.query",query_answered:"status.query_answered",complete_can_send_to_mmk:"status.complete_can_send_to_mmk",under_review_by_mmk:"status.under_review_by_mmk",document_accepted_by_mmk:"status.document_accepted_by_mmk",payment_in_progress:"status.payment_in_progress",payment_completed:"status.payment_completed",rejected:"status.rejected"}[s]||"status.draft"))})}),t.jsx("td",{className:"py-3 px-4 text-muted-foreground",children:E[e.submittedBy]||E[e.created_by]||e.submittedBy||e.created_by}),t.jsx("td",{className:"py-3 px-4 text-muted-foreground",children:new Date(e.createdAt).toLocaleDateString()})]},e.id);var s})})]})})})]})]})}export{L as default};
