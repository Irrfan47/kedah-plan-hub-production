import{m as e,G as s,z as a,j as l,e as r,E as t,H as i,J as n}from"./ui-vendor-1754357358322-Bp-UNE15.js";import{r as d}from"./react-vendor-1754357358322-BCu8432v.js";import{C as c,c as o,a as u,b as m}from"./card-1754357358322-jzcAFHNM.js";import{e as x,u as h,a as p,b as f,g as j,B as v,I as N,f as g,h as b,i as _,j as y}from"./index-1754357358322-CldQuBx-.js";import{L as w}from"./label-1754357358322-2ywHf4zy.js";import{B as k}from"./badge-1754357358322-C6KBoXlc.js";import{D as C,a as S,b as A,c as F,d as E,e as P}from"./dialog-1754357358322-2hcCCz0x.js";import{S as U,a as L,b as R,c as q,d as D}from"./select-1754357358322-DTWo5oSS.js";import{q as O,r as I,b as z,U as M,s as T,t as V,u as B,v as H,g as G}from"./icons-vendor-1754357358322-D5w6PadE.js";import"./utils-vendor-1754357358322-CYErry0n.js";import"./query-vendor-1754357358322-D8Bw-8e5.js";var J="Switch",[K,X]=e(J),[$,Q]=K(J),W=d.forwardRef((e,i)=>{const{__scopeSwitch:n,name:c,checked:o,defaultChecked:u,required:m,disabled:x,value:h="on",onCheckedChange:p,form:f,...j}=e,[v,N]=d.useState(null),g=s(i,e=>N(e)),b=d.useRef(!1),_=!v||(f||!!v.closest("form")),[y=!1,w]=a({prop:o,defaultProp:u,onChange:p});return l.jsxs($,{scope:n,checked:y,disabled:x,children:[l.jsx(r.button,{type:"button",role:"switch","aria-checked":y,"aria-required":m,"data-state":se(y),"data-disabled":x?"":void 0,disabled:x,value:h,...j,ref:g,onClick:t(e.onClick,e=>{w(e=>!e),_&&(b.current=e.isPropagationStopped(),b.current||e.stopPropagation())})}),_&&l.jsx(ee,{control:v,bubbles:!b.current,name:c,value:h,checked:y,required:m,disabled:x,form:f,style:{transform:"translateX(-100%)"}})]})});W.displayName=J;var Y="SwitchThumb",Z=d.forwardRef((e,s)=>{const{__scopeSwitch:a,...t}=e,i=Q(Y,a);return l.jsx(r.span,{"data-state":se(i.checked),"data-disabled":i.disabled?"":void 0,...t,ref:s})});Z.displayName=Y;var ee=e=>{const{control:s,checked:a,bubbles:r=!0,...t}=e,c=d.useRef(null),o=i(a),u=n(s);return d.useEffect(()=>{const e=c.current,s=window.HTMLInputElement.prototype,l=Object.getOwnPropertyDescriptor(s,"checked").set;if(o!==a&&l){const s=new Event("click",{bubbles:r});l.call(e,a),e.dispatchEvent(s)}},[o,a,r]),l.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:a,...t,tabIndex:-1,ref:c,style:{...e.style,...u,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})};function se(e){return e?"checked":"unchecked"}var ae=W,le=Z;const re=d.forwardRef(({className:e,...s},a)=>l.jsx(ae,{className:x("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...s,ref:a,children:l.jsx(le,{className:x("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));function te(){var e;const{user:s}=h(),{toast:a}=p(),{t:r}=f(),[t,i]=d.useState([]),[n,x]=d.useState(""),[J,K]=d.useState("all"),[X,$]=d.useState(!1),[Q,W]=d.useState(!1),[Y,Z]=d.useState(!1),[ee,se]=d.useState(null),[ae,le]=d.useState(null),[te,ie]=d.useState({fullName:"",email:"",password:"",phoneNumber:"",role:"exco_user"}),[ne,de]=d.useState({fullName:"",email:"",phoneNumber:"",role:"exco_user",password:""});d.useEffect(()=>{j().then(e=>{e.success&&e.users&&i(e.users)})},[]);const ce=t.length,oe=t.filter(e=>"admin"===e.role).length,ue=t.filter(e=>e.is_active||e.isActive).length,me=t.filter(e=>!(e.is_active||e.isActive)).length,xe=t.filter(e=>{const s=(e.fullName||e.full_name||"").toLowerCase().includes(n.toLowerCase())||e.email.toLowerCase().includes(n.toLowerCase()),a="all"===J||e.role===J;return s&&a});return"admin"!==(null==s?void 0:s.role)?l.jsx("div",{className:"flex items-center justify-center h-64",children:l.jsxs("div",{className:"text-center",children:[l.jsx(O,{className:"w-12 h-12 text-muted-foreground mx-auto mb-4"}),l.jsx("h2",{className:"text-xl font-semibold text-foreground",children:r("users.access_denied")}),l.jsx("p",{className:"text-muted-foreground",children:r("users.no_permission")})]})}):l.jsxs("div",{className:"space-y-6 mobile-zoom-out",children:[l.jsxs("div",{className:"flex justify-between items-center",children:[l.jsxs("div",{children:[l.jsx("h1",{className:"text-3xl font-bold text-foreground",children:r("users.title")}),l.jsx("p",{className:"text-muted-foreground mt-1",children:r("users.subtitle")})]}),l.jsxs(C,{open:X,onOpenChange:$,children:[l.jsx(S,{asChild:!0,children:l.jsxs(v,{className:"bg-gradient-primary hover:opacity-90",children:[l.jsx(I,{className:"w-4 h-4 mr-2"}),r("users.add_user")]})}),l.jsxs(A,{className:"sm:max-w-md",children:[l.jsxs(F,{children:[l.jsx(E,{children:r("users.add_new_user")}),l.jsx(P,{children:r("users.add_user_desc")})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(w,{htmlFor:"fullName",children:r("users.name")}),l.jsx(N,{id:"fullName",value:te.fullName,onChange:e=>ie(s=>({...s,fullName:e.target.value})),placeholder:r("users.enter_full_name")})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(w,{htmlFor:"email",children:r("users.email")}),l.jsx(N,{id:"email",type:"email",value:te.email,onChange:e=>ie(s=>({...s,email:e.target.value})),placeholder:"user@gov.my"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(w,{htmlFor:"password",children:r("users.password")}),l.jsx(N,{id:"password",type:"password",value:te.password,onChange:e=>ie(s=>({...s,password:e.target.value})),placeholder:r("users.enter_password")})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(w,{htmlFor:"phone",children:r("users.phone")}),l.jsx(N,{id:"phone",value:te.phoneNumber,onChange:e=>ie(s=>({...s,phoneNumber:e.target.value})),placeholder:"+60123456789"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(w,{htmlFor:"role",children:r("users.role")}),l.jsxs(U,{value:te.role,onValueChange:e=>ie(s=>({...s,role:e})),children:[l.jsx(L,{children:l.jsx(R,{placeholder:r("users.select_role")})}),l.jsxs(q,{children:[l.jsx(D,{value:"admin",children:r("role.admin")}),l.jsx(D,{value:"exco_user",children:r("role.exco_user")}),l.jsx(D,{value:"finance_mmk",children:r("role.finance_mmk")}),l.jsx(D,{value:"finance_officer",children:r("role.finance_officer")}),l.jsx(D,{value:"super_admin",children:r("role.super_admin")})]})]})]}),l.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[l.jsx(v,{variant:"outline",onClick:()=>$(!1),children:r("common.cancel")}),l.jsx(v,{onClick:async()=>{if(!(te.fullName&&te.email&&te.password&&te.phoneNumber))return void a({title:r("common.error"),description:r("users.fill_required_fields"),variant:"destructive"});const e={full_name:te.fullName,email:te.email,password:te.password,phone_number:te.phoneNumber,role:te.role},s=await g(e);s.success?(a({title:r("common.success"),description:r("users.added_successfully")}),j().then(e=>{e.success&&e.users&&i(e.users)}),ie({fullName:"",email:"",password:"",phoneNumber:"",role:"exco_user"}),$(!1)):a({title:r("common.error"),description:s.message||r("users.add_failed"),variant:"destructive"})},children:r("users.add_user")})]})]})]})]}),l.jsx(C,{open:Q,onOpenChange:W,children:l.jsxs(A,{className:"sm:max-w-md",children:[l.jsxs(F,{children:[l.jsx(E,{children:"Edit User"}),l.jsx(P,{children:"Update user information."})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"space-y-2",children:[l.jsx(w,{htmlFor:"editFullName",children:"Full Name"}),l.jsx(N,{id:"editFullName",value:ne.fullName,onChange:e=>de(s=>({...s,fullName:e.target.value})),placeholder:"Enter full name"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(w,{htmlFor:"editEmail",children:"Email"}),l.jsx(N,{id:"editEmail",type:"email",value:ne.email,onChange:e=>de(s=>({...s,email:e.target.value})),placeholder:"user@gov.my"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(w,{htmlFor:"editPhone",children:"Phone Number"}),l.jsx(N,{id:"editPhone",value:ne.phoneNumber,onChange:e=>de(s=>({...s,phoneNumber:e.target.value})),placeholder:"+60123456789"})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(w,{htmlFor:"editRole",children:"Role"}),l.jsxs(U,{value:ne.role,onValueChange:e=>de(s=>({...s,role:e})),children:[l.jsx(L,{children:l.jsx(R,{placeholder:"Select role"})}),l.jsxs(q,{children:[l.jsx(D,{value:"admin",children:"Admin"}),l.jsx(D,{value:"exco_user",children:"Exco User"}),l.jsx(D,{value:"finance_mmk",children:"Finance MMK"}),l.jsx(D,{value:"finance_officer",children:"Finance Officer"}),l.jsx(D,{value:"super_admin",children:"Super Admin"})]})]})]}),l.jsxs("div",{className:"space-y-2",children:[l.jsx(w,{htmlFor:"editPassword",children:"Password"}),l.jsx(N,{id:"editPassword",type:"password",value:ne.password,onChange:e=>de(s=>({...s,password:e.target.value})),placeholder:"Leave blank to keep current password",autoComplete:"new-password"})]}),l.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[l.jsx(v,{variant:"outline",onClick:()=>W(!1),children:"Cancel"}),l.jsx(v,{onClick:async()=>{if(!((null==ee?void 0:ee.id)&&ne.fullName&&ne.email&&ne.phoneNumber))return void a({title:r("common.error"),description:r("users.fill_required_fields"),variant:"destructive"});const e={full_name:ne.fullName,email:ne.email,phone_number:ne.phoneNumber,role:ne.role};ne.password&&""!==ne.password.trim()&&(e.password=ne.password);const s=await b(ee.id,e);s.success?(a({title:r("common.success"),description:r("users.updated_successfully")}),j().then(e=>{e.success&&e.users&&i(e.users)}),W(!1),se(null)):a({title:r("common.error"),description:s.message||r("users.update_failed"),variant:"destructive"})},children:"Update User"})]})]})]})}),l.jsx(C,{open:Y,onOpenChange:Z,children:l.jsxs(A,{className:"sm:max-w-md",children:[l.jsxs(F,{children:[l.jsx(E,{className:"text-red-600",children:"Delete User"}),l.jsx(P,{children:"Are you sure you want to delete this user? This action cannot be undone."})]}),l.jsxs("div",{className:"space-y-4",children:[l.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[l.jsxs("p",{className:"text-sm text-red-800",children:[l.jsx("strong",{children:"User to delete:"})," ",(null==ae?void 0:ae.fullName)||(null==ae?void 0:ae.full_name)]}),l.jsxs("p",{className:"text-sm text-red-700 mt-1",children:["Email: ",null==ae?void 0:ae.email]}),l.jsxs("p",{className:"text-sm text-red-700",children:["Role: ",null==(e=null==ae?void 0:ae.role)?void 0:e.replace("_"," ").toUpperCase()]})]}),l.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[l.jsx(v,{variant:"outline",onClick:()=>Z(!1),children:"Cancel"}),l.jsx(v,{variant:"destructive",onClick:async()=>{if(!(null==ae?void 0:ae.id))return void a({title:r("common.error"),description:r("users.user_not_found"),variant:"destructive"});const e=await _(ae.id);e.success?(a({title:r("common.success"),description:r("users.deleted_successfully")}),j().then(e=>{e.success&&e.users&&i(e.users)}),Z(!1),le(null)):a({title:r("common.error"),description:e.message||r("users.delete_failed"),variant:"destructive"})},className:"bg-red-600 hover:bg-red-700",children:"Delete User"})]})]})]})})]}),l.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[l.jsx(c,{className:"card-elevated",children:l.jsx(o,{className:"p-6",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r("users.total_users")}),l.jsx("p",{className:"text-3xl font-bold text-foreground",children:ce})]}),l.jsx("div",{className:"w-12 h-12 bg-primary-light rounded-xl flex items-center justify-center",children:l.jsx(z,{className:"w-6 h-6 text-primary"})})]})})}),l.jsx(c,{className:"card-elevated",children:l.jsx(o,{className:"p-6",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r("users.admins")}),l.jsx("p",{className:"text-3xl font-bold text-primary",children:oe})]}),l.jsx("div",{className:"w-12 h-12 bg-primary-light rounded-xl flex items-center justify-center",children:l.jsx(O,{className:"w-6 h-6 text-primary"})})]})})}),l.jsx(c,{className:"card-elevated",children:l.jsx(o,{className:"p-6",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r("users.active_users")}),l.jsx("p",{className:"text-3xl font-bold text-success",children:ue})]}),l.jsx("div",{className:"w-12 h-12 bg-success-light rounded-xl flex items-center justify-center",children:l.jsx(M,{className:"w-6 h-6 text-success"})})]})})}),l.jsx(c,{className:"card-elevated",children:l.jsx(o,{className:"p-6",children:l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{children:[l.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:r("users.inactive_users")}),l.jsx("p",{className:"text-3xl font-bold text-danger",children:me})]}),l.jsx("div",{className:"w-12 h-12 bg-danger-light rounded-xl flex items-center justify-center",children:l.jsx(T,{className:"w-6 h-6 text-danger"})})]})})})]}),l.jsx(c,{className:"card-elevated",children:l.jsx(o,{className:"p-6",children:l.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[l.jsx("div",{className:"flex-1",children:l.jsxs("div",{className:"relative",children:[l.jsx(V,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),l.jsx(N,{placeholder:r("users.search_placeholder"),value:n,onChange:e=>x(e.target.value),className:"pl-10 max-w-sm"})]})}),l.jsx("div",{className:"sm:w-48",children:l.jsxs(U,{value:J,onValueChange:K,children:[l.jsxs(L,{className:"w-48",children:[l.jsx(B,{className:"w-4 h-4 mr-2"}),l.jsx(R,{placeholder:r("users.all_roles")})]}),l.jsxs(q,{children:[l.jsx(D,{value:"all",children:r("users.all_roles")}),l.jsx(D,{value:"admin",children:r("role.admin")}),l.jsx(D,{value:"exco_user",children:r("role.exco_user")}),l.jsx(D,{value:"finance_mmk",children:r("role.finance_mmk")}),l.jsx(D,{value:"finance_officer",children:r("role.finance_officer")}),l.jsx(D,{value:"super_admin",children:r("role.super_admin")})]})]})})]})})}),l.jsxs(c,{className:"card-elevated",children:[l.jsx(u,{children:l.jsx(m,{className:"text-lg font-semibold",children:r("users.users_count").replace("{count}",xe.length.toString())})}),l.jsx(o,{children:l.jsx("div",{className:"overflow-x-auto",children:l.jsxs("table",{className:"w-full",children:[l.jsx("thead",{children:l.jsxs("tr",{className:"border-b border-border",children:[l.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:r("table.name")}),l.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:r("table.email")}),l.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:r("table.phone")}),l.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:r("table.role")}),l.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:r("table.status")}),l.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:r("table.created")}),l.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:r("users.last_login")}),l.jsx("th",{className:"text-left py-3 px-4 font-medium text-muted-foreground",children:r("table.actions")})]})}),l.jsx("tbody",{children:xe.map(e=>{return l.jsxs("tr",{className:"border-b border-border hover:bg-muted/50 transition-fast",children:[l.jsx("td",{className:"py-3 px-4 font-medium text-foreground",children:e.fullName||e.full_name}),l.jsx("td",{className:"py-3 px-4 text-muted-foreground",children:e.email}),l.jsx("td",{className:"py-3 px-4 text-muted-foreground",children:e.phoneNumber||e.phone_number}),l.jsx("td",{className:"py-3 px-4",children:(n=e.role,l.jsx(k,{className:{admin:"bg-primary-light text-primary",exco_user:"bg-success-light text-success",finance_mmk:"bg-secondary-light text-secondary",finance_officer:"bg-blue-100 text-blue-800",super_admin:"bg-purple-100 text-purple-800"}[n],children:r(`role.${n}`)}))}),l.jsx("td",{className:"py-3 px-4",children:l.jsx(k,{className:e.is_active||e.isActive?"bg-success-light text-success":"bg-danger-light text-danger",children:e.is_active||e.isActive?"Active":"Inactive"})}),l.jsx("td",{className:"py-3 px-4 text-muted-foreground",children:e.created_at||e.createdAt?new Date(e.created_at||e.createdAt).toLocaleDateString():"N/A"}),l.jsx("td",{className:"py-3 px-4 text-muted-foreground",children:e.last_login?new Date(e.last_login).toLocaleString():"Never"}),l.jsx("td",{className:"py-3 px-4",children:l.jsxs("div",{className:"flex items-center space-x-2",children:[l.jsx(v,{variant:"outline",size:"sm",onClick:()=>(e=>{se(e),de({fullName:e.fullName||e.full_name||"",email:e.email||"",phoneNumber:e.phoneNumber||e.phone_number||"",role:e.role||"exco_user",password:""}),W(!0)})(e),disabled:e.id===(null==s?void 0:s.id),children:l.jsx(H,{className:"h-4 w-4"})}),l.jsx(v,{variant:"outline",size:"sm",onClick:()=>(e=>{le(e),Z(!0)})(e),disabled:e.id===(null==s?void 0:s.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:l.jsx(G,{className:"h-4 w-4"})}),l.jsx(re,{checked:e.is_active||e.isActive,onCheckedChange:()=>(async e=>{var s,l;const n=!((null==(s=t.find(s=>s.id===e))?void 0:s.is_active)||(null==(l=t.find(s=>s.id===e))?void 0:l.isActive)),d=await y(e,n);d.success?(a({title:r("common.success"),description:r("users.status_updated")}),j().then(e=>{e.success&&e.users&&i(e.users)})):a({title:r("common.error"),description:d.message||r("users.status_update_failed"),variant:"destructive"})})(e.id),disabled:e.id===(null==s?void 0:s.id)}),l.jsx("span",{className:"text-xs text-muted-foreground",children:e.is_active||e.isActive?"Active":"Inactive"})]})})]},e.id);var n})})]})})})]})]})}re.displayName=ae.displayName;export{te as default};
