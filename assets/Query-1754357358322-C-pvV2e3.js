import{j as e}from"./ui-vendor-1754357358322-Bp-UNE15.js";import{r as a}from"./react-vendor-1754357358322-BCu8432v.js";import{C as s,a as t,b as n,c as r}from"./card-1754357358322-jzcAFHNM.js";import{a as i,u as l,b as d,k as c,B as o,I as m,l as u,v as x,t as h,w as p,r as j,s as g,q as f}from"./index-1754357358322-CldQuBx-.js";import{T as v,a as N,b as y,c as b,d as k,e as w}from"./table-1754357358322-C8S8WM1D.js";import{B as _}from"./badge-1754357358322-C6KBoXlc.js";import{D as P,b as K,c as A,d as C}from"./dialog-1754357358322-2hcCCz0x.js";import{T as q}from"./textarea-1754357358322-BlPR2iv_.js";import{L as D}from"./label-1754357358322-2ywHf4zy.js";import{l as S,x as E,M as B,v as z,F as L,G as F,z as R,X as O}from"./icons-vendor-1754357358322-D5w6PadE.js";import"./utils-vendor-1754357358322-CYErry0n.js";import"./query-vendor-1754357358322-D8Bw-8e5.js";const M=e=>{const a={query:"bg-orange-100 text-orange-800",query_answered:"bg-purple-100 text-purple-800",payment_completed:"bg-green-100 text-green-800",draft:"bg-gray-100 text-gray-800",under_review:"bg-blue-100 text-blue-800",rejected:"bg-red-100 text-red-800"};return a[e]||a.draft};function Q(){var Q,T,$,U;const{toast:X}=i(),{user:I}=l(),{t:G}=d(),[V,H]=a.useState([]),[J,W]=a.useState(null),[Y,Z]=a.useState(!1),[ee,ae]=a.useState(!1),[se,te]=a.useState(!1),[ne,re]=a.useState(!1),[ie,le]=a.useState(!1),[de,ce]=a.useState({});a.useState(null);const[oe,me]=a.useState([]),[ue,xe]=a.useState("original"),[he,pe]=a.useState(""),[je,ge]=a.useState({programName:"",budget:"",recipientName:"",excoLetterRef:"",suratAkuanPusatKhidmat:null,suratKelulusanPkn:null,suratProgram:null,suratExco:null,penyataAkaunBank:null,borangDaftarKod:null}),[fe,ve]=a.useState({});a.useEffect(()=>{c().then(e=>{e.success&&e.programs&&H(e.programs)}),fetch("http://localhost/api/users.php").then(e=>e.json()).then(e=>{if(e.success&&e.users){const a={};e.users.forEach(e=>{a[e.id]=e.fullName||e.full_name||e.email||e.id}),ve(a)}}).catch(e=>{})},[]);const Ne=V.filter(e=>"query"===e.status),ye=V.filter(e=>"query_answered"===e.status||"payment_completed"===e.status),be=async e=>{if(J)try{const a=await g(e);if(a.success){X({title:G("common.success"),description:G("queries.document_deleted")});const e=await c();if(e.success){H(e.programs);const a=e.programs.find(e=>e.id===J.id);a&&W(a)}}else X({title:G("common.error"),description:a.message||G("queries.delete_document_failed"),variant:"destructive"})}catch(a){X({title:G("common.error"),description:G("queries.delete_document_failed"),variant:"destructive"})}else X({title:G("common.error"),description:G("queries.no_program_selected"),variant:"destructive"})},ke=e=>({draft:"status.draft",under_review:"status.under_review",query:"status.query",query_answered:"status.query_answered",complete_can_send_to_mmk:"status.complete_can_send_to_mmk",under_review_by_mmk:"status.under_review_by_mmk",document_accepted_by_mmk:"status.document_accepted_by_mmk",payment_in_progress:"status.payment_in_progress",payment_completed:"status.payment_completed",rejected:"status.rejected"}[e]||"status.draft");return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:G("queries.management")}),e.jsx("p",{className:"text-muted-foreground",children:G("queries.subtitle")})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs(s,{children:[e.jsx(t,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(n,{className:"text-sm font-medium",children:G("queries.active_queries")})}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:Ne.length})})]}),e.jsxs(s,{children:[e.jsx(t,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(n,{className:"text-sm font-medium",children:G("queries.answered_queries")})}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:ye.length})})]}),e.jsxs(s,{children:[e.jsx(t,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:e.jsx(n,{className:"text-sm font-medium",children:G("queries.total_programs")})}),e.jsx(r,{children:e.jsx("div",{className:"text-2xl font-bold",children:V.length})})]})]}),e.jsxs(s,{children:[e.jsx(t,{children:e.jsx(n,{children:G("queries.active_queries")})}),e.jsx(r,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs(y,{children:[e.jsx(b,{children:G("programs.program_name")}),e.jsx(b,{children:G("programs.budget_rm")}),e.jsx(b,{children:G("programs.status")}),e.jsx(b,{children:G("queries.title")}),e.jsx(b,{children:G("programs.actions")})]})}),e.jsx(k,{children:Ne.map(a=>e.jsxs(y,{children:[e.jsx(w,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>{W(a),xe("original"),ae(!0)},className:"h-6 w-6 p-0",children:e.jsx(S,{className:"h-4 w-4"})}),e.jsx("span",{children:a.program_name||a.programName})]})}),e.jsx(w,{children:a.budget.toLocaleString()}),e.jsx(w,{children:e.jsx(_,{className:M(a.status||""),children:G(ke(a.status||""))})}),e.jsx(w,{children:e.jsxs("span",{className:"text-orange-600",children:[a.queries.filter(e=>!e.answered).length," ",G("queries.pending")]})}),e.jsx(w,{children:e.jsx("div",{className:"flex gap-2",children:"finance_mmk"===(null==I?void 0:I.role)?"query"===a.status?e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{W(a),le(!0)},children:e.jsx(E,{className:"h-4 w-4"})}):"query_answered"===a.status?e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{W(a),Z(!0)},children:e.jsx(B,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{W(a);const e=(e=>{const a={suratAkuanPusatKhidmat:null,suratKelulusanPkn:null,suratProgram:null,suratExco:null,penyataAkaunBank:null,borangDaftarKod:null};return e.documents&&Array.isArray(e.documents)&&e.documents.forEach(e=>{const s=e.original_name||e.name;s.includes("Surat Akuan Pusat Khidmat")?a.suratAkuanPusatKhidmat=e:s.includes("Surat Kelulusan Pkn")?a.suratKelulusanPkn=e:s.includes("Surat Program")?a.suratProgram=e:s.includes("Surat Exco")?a.suratExco=e:s.includes("Penyata Akaun Bank")?a.penyataAkaunBank=e:s.includes("Borang Daftar Kod")&&(a.borangDaftarKod=e)}),a})(a);ge({programName:a.program_name||a.programName,budget:a.budget.toString(),recipientName:a.recipient_name||a.recipientName,excoLetterRef:a.exco_letter_ref||a.excoLetterRef,...e}),xe("original"),te(!0)},children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{W(a),re(!0)},children:e.jsx(S,{className:"h-4 w-4"})})]}):null:"exco_user"===(null==I?void 0:I.role)?e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{W(a),Z(!0)},children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{W(a);const e=(e=>{const a={suratAkuanPusatKhidmat:null,suratKelulusanPkn:null,suratProgram:null,suratExco:null,penyataAkaunBank:null,borangDaftarKod:null};return e.documents&&Array.isArray(e.documents)&&e.documents.forEach(e=>{const s=e.original_name||e.name;s.includes("Surat Akuan Pusat Khidmat")?a.suratAkuanPusatKhidmat=e:s.includes("Surat Kelulusan Pkn")?a.suratKelulusanPkn=e:s.includes("Surat Program")?a.suratProgram=e:s.includes("Surat Exco")?a.suratExco=e:s.includes("Penyata Akaun Bank")?a.penyataAkaunBank=e:s.includes("Borang Daftar Kod")&&(a.borangDaftarKod=e)}),a})(a);ge({programName:a.program_name||a.programName,budget:a.budget.toString(),recipientName:a.recipient_name||a.recipientName,excoLetterRef:a.exco_letter_ref||a.excoLetterRef,...e}),xe("original"),te(!0)},children:e.jsx(z,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{W(a),re(!0)},children:e.jsx(S,{className:"h-4 w-4"})})]}):null})})]},a.id))})]})})})]}),e.jsxs(s,{children:[e.jsx(t,{children:e.jsx(n,{children:G("queries.history")})}),e.jsx(r,{children:e.jsx("div",{className:"rounded-md border",children:e.jsxs(v,{children:[e.jsx(N,{children:e.jsxs(y,{children:[e.jsx(b,{children:G("programs.program_name")}),e.jsx(b,{children:G("programs.budget_rm")}),e.jsx(b,{children:G("programs.status")}),e.jsx(b,{children:G("queries.total_queries")}),e.jsx(b,{children:G("programs.actions")})]})}),e.jsx(k,{children:ye.map(a=>e.jsxs(y,{children:[e.jsx(w,{className:"font-medium",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>{W(a),xe("original"),ae(!0)},className:"h-6 w-6 p-0",children:e.jsx(S,{className:"h-4 w-4"})}),e.jsx("span",{children:a.program_name||a.programName})]})}),e.jsx(w,{children:a.budget.toLocaleString()}),e.jsx(w,{children:e.jsx(_,{className:M(a.status||""),children:G(ke(a.status||""))})}),e.jsx(w,{children:a.queries.length}),e.jsx(w,{children:e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{W(a),Z(!0)},children:e.jsx(B,{className:"h-4 w-4"})})})]},a.id))})]})})})]}),e.jsx(P,{open:Y,onOpenChange:Z,children:e.jsxs(K,{className:"max-w-2xl",children:[e.jsx(A,{children:e.jsxs(C,{children:["Queries - ",(null==J?void 0:J.program_name)||(null==J?void 0:J.programName)]})}),e.jsx("div",{className:"space-y-4",children:null==J?void 0:J.queries.map(a=>e.jsxs("div",{className:"border rounded p-4 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium",children:["Query from ",a.created_by||a.createdBy]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(a.created_at||a.createdAt).toLocaleDateString()})]}),e.jsx(_,{variant:a.answered?"default":"destructive",children:a.answered?"Answered":"Pending"})]}),e.jsx("div",{className:"bg-muted p-3 rounded",children:e.jsx("p",{className:"text-sm",children:a.question||a.message})}),a.answered&&a.answer&&e.jsxs("div",{className:"bg-green-50 p-3 rounded border-l-4 border-green-400",children:[e.jsx("p",{className:"text-sm font-medium text-green-800",children:"Answer:"}),e.jsx("p",{className:"text-sm text-green-700",children:a.answer})]}),!a.answered&&"query"===(null==J?void 0:J.status)&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(q,{placeholder:"Type your answer here...",value:de[a.id]||"",onChange:e=>ce(s=>({...s,[a.id]:e.target.value}))}),e.jsx(o,{size:"sm",onClick:()=>(async(e,a,s)=>{if(s.trim())try{const e=await p(a,s,(null==I?void 0:I.fullName)||(null==I?void 0:I.full_name)||"EXCO User");if(e.success){X({title:G("common.success"),description:G("queries.answered_successfully")});const e=await c();e.success&&H(e.programs),Z(!1)}else X({title:G("common.error"),description:e.message||G("queries.answer_failed"),variant:"destructive"})}catch(t){X({title:G("common.error"),description:G("queries.answer_failed"),variant:"destructive"})}else X({title:G("common.error"),description:G("queries.provide_answer"),variant:"destructive"})})(J.id,a.id,de[a.id]||""),children:"Submit Answer"})]})]},a.id))})]})}),e.jsx(P,{open:ie,onOpenChange:le,children:e.jsxs(K,{className:"max-w-2xl",children:[e.jsx(A,{children:e.jsxs(C,{children:["Submit Query - ",(null==J?void 0:J.program_name)||(null==J?void 0:J.programName)]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"queryMessage",children:"Query Message *"}),e.jsx(q,{id:"queryMessage",placeholder:"Type your query here...",value:he,onChange:e=>pe(e.target.value),rows:4})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(o,{variant:"outline",onClick:()=>{le(!1),pe("")},children:"Cancel"}),e.jsx(o,{onClick:async()=>{if(J&&he.trim())try{const e=await h(J.id,he,(null==I?void 0:I.fullName)||(null==I?void 0:I.full_name)||"");if(e.success){X({title:G("common.success"),description:G("queries.submitted_successfully")}),pe(""),le(!1);const e=await c();e.success&&H(e.programs)}else X({title:G("common.error"),description:e.message||G("queries.submit_failed"),variant:"destructive"})}catch(e){X({title:G("common.error"),description:G("queries.submit_failed"),variant:"destructive"})}else X({title:G("common.error"),description:G("queries.provide_message"),variant:"destructive"})},disabled:!he.trim(),children:"Submit Query"})]})]})]})}),e.jsx(P,{open:se,onOpenChange:te,children:e.jsxs(K,{className:"max-w-2xl max-h-[90vh]",children:[e.jsx(A,{children:e.jsxs(C,{children:["Edit Program - ",(null==J?void 0:J.program_name)||(null==J?void 0:J.programName)]})}),e.jsxs("div",{className:"space-y-4 overflow-y-auto max-h-[calc(90vh-120px)] pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"editProgramName",children:"Program Name *"}),e.jsx(m,{id:"editProgramName",value:je.programName,onChange:e=>ge({...je,programName:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"editBudget",children:"Budget (RM) *"}),e.jsx(m,{id:"editBudget",type:"number",value:je.budget,onChange:e=>ge({...je,budget:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"editRecipientName",children:"Recipient Name *"}),e.jsx(m,{id:"editRecipientName",value:je.recipientName,onChange:e=>ge({...je,recipientName:e.target.value})})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"editExcoLetterRef",children:"EXCO Letter Reference Number *"}),e.jsx(m,{id:"editExcoLetterRef",value:je.excoLetterRef,onChange:e=>ge({...je,excoLetterRef:e.target.value})})]})]}),e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsx(D,{className:"text-base font-semibold mb-3",children:"Documents"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"text-sm font-medium min-w-[200px]",children:"Surat Akuan Pusat Khidmat"}),e.jsx("div",{className:"flex-1",children:je.suratAkuanPusatKhidmat&&"object"==typeof je.suratAkuanPusatKhidmat&&"id"in je.suratAkuanPusatKhidmat?e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-gray-50",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-sm",children:je.suratAkuanPusatKhidmat.original_name||je.suratAkuanPusatKhidmat.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:async()=>{try{await u(je.suratAkuanPusatKhidmat.id,je.suratAkuanPusatKhidmat.original_name||je.suratAkuanPusatKhidmat.name),X({title:"Success",description:"Document downloaded successfully"})}catch(e){X({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{be(je.suratAkuanPusatKhidmat.id),ge({...je,suratAkuanPusatKhidmat:null})},children:e.jsx(R,{className:"h-4 w-4"})})]})]}):e.jsx(m,{type:"file",onChange:e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];s&&ge({...je,suratAkuanPusatKhidmat:s})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"})}),je.suratAkuanPusatKhidmat&&"object"==typeof je.suratAkuanPusatKhidmat&&!("id"in je.suratAkuanPusatKhidmat)&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{ge({...je,suratAkuanPusatKhidmat:null})},children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"text-sm font-medium min-w-[200px]",children:"Surat Kelulusan Pkn"}),e.jsx("div",{className:"flex-1",children:je.suratKelulusanPkn&&"object"==typeof je.suratKelulusanPkn&&"id"in je.suratKelulusanPkn?e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-gray-50",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-sm",children:je.suratKelulusanPkn.original_name||je.suratKelulusanPkn.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:async()=>{try{await u(je.suratKelulusanPkn.id,je.suratKelulusanPkn.original_name||je.suratKelulusanPkn.name),X({title:"Success",description:"Document downloaded successfully"})}catch(e){X({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{be(je.suratKelulusanPkn.id),ge({...je,suratKelulusanPkn:null})},children:e.jsx(R,{className:"h-4 w-4"})})]})]}):e.jsx(m,{type:"file",onChange:e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];s&&ge({...je,suratKelulusanPkn:s})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"})}),je.suratKelulusanPkn&&"object"==typeof je.suratKelulusanPkn&&!("id"in je.suratKelulusanPkn)&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{ge({...je,suratKelulusanPkn:null})},children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"text-sm font-medium min-w-[200px]",children:"Surat Program"}),e.jsx("div",{className:"flex-1",children:je.suratProgram&&"object"==typeof je.suratProgram&&"id"in je.suratProgram?e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-gray-50",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-sm",children:je.suratProgram.original_name||je.suratProgram.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:async()=>{try{await u(je.suratProgram.id,je.suratProgram.original_name||je.suratProgram.name),X({title:"Success",description:"Document downloaded successfully"})}catch(e){X({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{be(je.suratProgram.id),ge({...je,suratProgram:null})},children:e.jsx(R,{className:"h-4 w-4"})})]})]}):e.jsx(m,{type:"file",onChange:e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];s&&ge({...je,suratProgram:s})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"})}),je.suratProgram&&"object"==typeof je.suratProgram&&!("id"in je.suratProgram)&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{ge({...je,suratProgram:null})},children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"text-sm font-medium min-w-[200px]",children:"Surat Exco"}),e.jsx("div",{className:"flex-1",children:je.suratExco&&"object"==typeof je.suratExco&&"id"in je.suratExco?e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-gray-50",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-sm",children:je.suratExco.original_name||je.suratExco.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:async()=>{try{await u(je.suratExco.id,je.suratExco.original_name||je.suratExco.name),X({title:"Success",description:"Document downloaded successfully"})}catch(e){X({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{be(je.suratExco.id),ge({...je,suratExco:null})},children:e.jsx(R,{className:"h-4 w-4"})})]})]}):e.jsx(m,{type:"file",onChange:e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];s&&ge({...je,suratExco:s})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"})}),je.suratExco&&"object"==typeof je.suratExco&&!("id"in je.suratExco)&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{ge({...je,suratExco:null})},children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"text-sm font-medium min-w-[200px]",children:"Penyata Akaun Bank"}),e.jsx("div",{className:"flex-1",children:je.penyataAkaunBank&&"object"==typeof je.penyataAkaunBank&&"id"in je.penyataAkaunBank?e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-gray-50",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-sm",children:je.penyataAkaunBank.original_name||je.penyataAkaunBank.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:async()=>{try{await u(je.penyataAkaunBank.id,je.penyataAkaunBank.original_name||je.penyataAkaunBank.name),X({title:"Success",description:"Document downloaded successfully"})}catch(e){X({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{be(je.penyataAkaunBank.id),ge({...je,penyataAkaunBank:null})},children:e.jsx(R,{className:"h-4 w-4"})})]})]}):e.jsx(m,{type:"file",onChange:e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];s&&ge({...je,penyataAkaunBank:s})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"})}),je.penyataAkaunBank&&"object"==typeof je.penyataAkaunBank&&!("id"in je.penyataAkaunBank)&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{ge({...je,penyataAkaunBank:null})},children:e.jsx(O,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(D,{className:"text-sm font-medium min-w-[200px]",children:"Borang Daftar Kod"}),e.jsx("div",{className:"flex-1",children:je.borangDaftarKod&&"object"==typeof je.borangDaftarKod&&"id"in je.borangDaftarKod?e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded bg-gray-50",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"flex-1 text-sm",children:je.borangDaftarKod.original_name||je.borangDaftarKod.name}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:async()=>{try{await u(je.borangDaftarKod.id,je.borangDaftarKod.original_name||je.borangDaftarKod.name),X({title:"Success",description:"Document downloaded successfully"})}catch(e){X({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{be(je.borangDaftarKod.id),ge({...je,borangDaftarKod:null})},children:e.jsx(R,{className:"h-4 w-4"})})]})]}):e.jsx(m,{type:"file",onChange:e=>{var a;const s=null==(a=e.target.files)?void 0:a[0];s&&ge({...je,borangDaftarKod:s})},accept:".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif,.bmp,.webp"})}),je.borangDaftarKod&&"object"==typeof je.borangDaftarKod&&!("id"in je.borangDaftarKod)&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>{ge({...je,borangDaftarKod:null})},children:e.jsx(O,{className:"h-4 w-4"})})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(o,{variant:"outline",onClick:()=>{te(!1),me([])},children:"Cancel"}),e.jsx(o,{onClick:async()=>{var e;if(!(je.programName&&je.budget&&je.recipientName&&je.excoLetterRef))return void X({title:G("common.error"),description:G("queries.fill_required_fields"),variant:"destructive"});if(!J)return;const a={program_name:je.programName,budget:parseFloat(je.budget),recipient_name:je.recipientName,exco_letter_ref:je.excoLetterRef},s=await j(J.id,a);if(s.success){const a=[{field:"suratAkuanPusatKhidmat",name:"Surat Akuan Pusat Khidmat"},{field:"suratKelulusanPkn",name:"Surat Kelulusan Pkn"},{field:"suratProgram",name:"Surat Program"},{field:"suratExco",name:"Surat Exco"},{field:"penyataAkaunBank",name:"Penyata Akaun Bank"},{field:"borangDaftarKod",name:"Borang Daftar Kod"}],s=Date.now();for(const r of a){const a=je[r.field];if(a)try{const t=J.id,n=a.name.split(".").pop(),i=null==(e=J.documents)?void 0:e.find(e=>(e.original_name||e.name).includes(r.name));i&&await g(i.id);const l=`${r.name}(${t})(edit${s}).${n}`,d=new File([a],l,{type:a.type});await f(t,d)}catch(t){X({title:G("common.error"),description:`Failed to upload ${r.name}`,variant:"destructive"})}}X({title:G("common.success"),description:G("queries.program_updated")});const n=await c();n.success&&H(n.programs),te(!1),W(null),ge({programName:"",budget:"",recipientName:"",excoLetterRef:"",suratAkuanPusatKhidmat:null,suratKelulusanPkn:null,suratProgram:null,suratExco:null,penyataAkaunBank:null,borangDaftarKod:null})}else X({title:G("common.error"),description:s.message||G("queries.update_program_failed"),variant:"destructive"})},children:"Update Program"})]})]})]})}),e.jsx(P,{open:ne,onOpenChange:re,children:e.jsxs(K,{children:[e.jsx(A,{children:e.jsxs(C,{children:["Documents - ",(null==J?void 0:J.program_name)||(null==J?void 0:J.programName)]})}),e.jsx("div",{className:"space-y-4",children:null==(Q=null==J?void 0:J.documents)?void 0:Q.map(a=>{const s=a.original_name&&/\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(a.original_name);return e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium",children:a.original_name||a.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Uploaded: ",new Date(a.uploaded_at||a.uploadedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex gap-1",children:[s&&e.jsx(o,{variant:"outline",size:"sm",onClick:async()=>{try{await x(a.id,a.original_name);X({title:"Success",description:"Image opened in new tab"})}catch(e){X({title:"Error",description:"Failed to view image. Please try again.",variant:"destructive"})}},children:e.jsx(S,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:async()=>{try{await u(a.id,a.original_name),X({title:"Success",description:"Document downloaded successfully"})}catch(e){X({title:"Error",description:"Failed to download document. Please try again.",variant:"destructive"})}},children:e.jsx(F,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>be(a.id),children:e.jsx(R,{className:"h-4 w-4"})})]})]},a.id)})})]})}),e.jsx(P,{open:ee,onOpenChange:ae,children:e.jsxs(K,{className:"max-w-2xl max-h-[90vh]",children:[e.jsx(A,{children:e.jsxs(C,{children:["Program Details - ",(null==J?void 0:J.program_name)||(null==J?void 0:J.programName)]})}),e.jsxs("div",{className:"space-y-4 overflow-y-auto max-h-[calc(90vh-120px)] pr-2 scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Program Name"}),e.jsx("p",{className:"font-medium",children:(null==J?void 0:J.program_name)||(null==J?void 0:J.programName)})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Budget (RM)"}),e.jsxs("p",{className:"font-medium",children:["RM ",null==(T=null==J?void 0:J.budget)?void 0:T.toLocaleString()]})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Recipient Name"}),e.jsx("p",{className:"font-medium",children:(null==J?void 0:J.recipient_name)||(null==J?void 0:J.recipientName)})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"EXCO Letter Reference"}),e.jsx("p",{className:"font-medium",children:(null==J?void 0:J.exco_letter_ref)||(null==J?void 0:J.excoLetterRef)})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Status"}),e.jsx(_,{className:M((null==J?void 0:J.status)||""),children:G(ke((null==J?void 0:J.status)||""))})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Created By"}),e.jsx("p",{className:"font-medium",children:fe[(null==J?void 0:J.created_by)||(null==J?void 0:J.createdBy)]||(null==J?void 0:J.created_by)||(null==J?void 0:J.createdBy)})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Created Date"}),e.jsx("p",{className:"font-medium",children:new Date((null==J?void 0:J.created_at)||(null==J?void 0:J.createdAt)).toLocaleDateString()})]}),(null==J?void 0:J.voucher_number)&&e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"Voucher Number"}),e.jsx("p",{className:"font-medium",children:J.voucher_number})]}),(null==J?void 0:J.eft_number)&&e.jsxs("div",{children:[e.jsx(D,{className:"text-sm font-medium text-muted-foreground",children:"EFT Number"}),e.jsx("p",{className:"font-medium",children:J.eft_number})]})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-base font-semibold",children:"Documents"}),e.jsxs("div",{className:"flex space-x-1 mb-3",children:[e.jsxs(o,{variant:"original"===ue?"default":"outline",size:"sm",onClick:()=>xe("original"),className:"text-xs",children:["Original Documents (",(null==($=null==J?void 0:J.documents)?void 0:$.filter(e=>"original"===e.document_type||!e.document_type).length)||0,")"]}),e.jsxs(o,{variant:"finance"===ue?"default":"outline",size:"sm",onClick:()=>xe("finance"),className:"text-xs",children:["Finance's Documents (",(null==(U=null==J?void 0:J.documents)?void 0:U.filter(e=>"finance"===e.document_type).length)||0,")"]})]}),e.jsx("div",{className:"space-y-2",children:(null==J?void 0:J.documents)&&J.documents.length>0?e.jsx("div",{className:"border rounded p-2 space-y-1 max-h-32 overflow-y-auto",children:J.documents.filter(e=>"original"===ue?"original"===e.document_type||!e.document_type:"finance"===e.document_type).map(a=>{const s=a.original_name&&/\.(jpg|jpeg|png|gif|bmp|webp)$/i.test(a.original_name);return e.jsxs("div",{className:"flex items-center gap-2 p-2 border rounded",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"font-medium",children:a.original_name||a.name}),a.uploaded_by&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Uploaded by: ",a.uploaded_by]})]}),e.jsxs("div",{className:"flex gap-1",children:[s&&e.jsx(o,{variant:"outline",size:"sm",onClick:async()=>{try{await x(a.id,a.original_name||a.name),X({title:"Success",description:"Document opened in new tab"})}catch(e){X({title:"Error",description:"Failed to view document",variant:"destructive"})}},children:e.jsx(S,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:async()=>{try{await u(a.id,a.original_name||a.name),X({title:"Success",description:"Document downloaded successfully"})}catch(e){X({title:"Error",description:"Failed to download document",variant:"destructive"})}},children:e.jsx(F,{className:"h-4 w-4"})})]})]},a.id)})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No documents uploaded yet."})})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-base font-semibold",children:"Queries"}),e.jsx("div",{className:"space-y-2",children:(null==J?void 0:J.queries)&&J.queries.length>0?e.jsx("div",{className:"border rounded p-2 space-y-1 max-h-32 overflow-y-auto",children:J.queries.map(a=>e.jsxs("div",{className:"p-2 border rounded bg-muted",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-semibold text-sm text-blue-600",children:a.created_by||a.createdBy}),e.jsx(_,{variant:a.answered?"default":"secondary",children:a.answered?"Answered":"Pending"})]}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[new Date(a.created_at||a.createdAt).toLocaleDateString()," at ",new Date(a.created_at||a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsxs("p",{className:"text-sm font-medium",children:["Q: ",a.question||a.message]}),a.answer&&e.jsx("div",{className:"mt-2 p-2 bg-white rounded border-l-4 border-green-500",children:e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"A:"})," ",a.answer]})})]},a.id))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No queries yet."})})]}),e.jsxs("div",{children:[e.jsx(D,{className:"text-base font-semibold",children:"Remarks"}),e.jsx("div",{className:"space-y-2",children:(null==J?void 0:J.remarks)&&J.remarks.length>0?e.jsx("div",{className:"border rounded p-2 space-y-1 max-h-32 overflow-y-auto",children:J.remarks.map(a=>e.jsxs("div",{className:"p-2 border rounded bg-muted",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-semibold text-sm text-blue-600",children:a.created_by||a.createdBy})}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[new Date(a.created_at||a.createdAt).toLocaleDateString()," at ",new Date(a.created_at||a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),e.jsx("p",{className:"text-sm",children:a.remark||a.message})]},a.id))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No remarks yet."})})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsx(o,{variant:"outline",onClick:()=>ae(!1),children:"Close"})})]})]})})]})}export{Q as default};
